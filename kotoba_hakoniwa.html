<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ãƒˆãƒã®ç®±åº­ - æˆé•·ã™ã‚‹æ—¥è¨˜</title>
    <style>
        /*
         * ã€å…ˆç”Ÿæ–¹ã¸ï¼šãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šã€‘
         * æ—¥è¨˜å¸³ã®ã‚ˆã†ãªæ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ã§ã™ã€‚
         * åˆæœŸåŒ–ãƒœã‚¿ãƒ³ã¯èª¤æ“ä½œé˜²æ­¢ã®ãŸã‚ã€æ§ãˆã‚ãªãƒ‡ã‚¶ã‚¤ãƒ³ã«ã—ã¦ã„ã¾ã™ã€‚
         */
        :root {
            --bg-color: #FDFBF7; /* ç”Ÿæˆã‚Šã®ç´™ã®ã‚ˆã†ãªè‰² */
            --accent-green: #88D8B0;
            --accent-pink: #FFB7B2;
            --accent-blue: #AEC6CF;
            --text-main: #4A4A4A;
            --text-light: #888888;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --font-base: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            font-family: var(--font-base);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            background-image: radial-gradient(#E0E0E0 1px, transparent 1px);
            background-size: 20px 20px; /* æ–¹çœ¼ç´™é¢¨ã®èƒŒæ™¯ */
        }

        .container {
            width: 100%;
            max-width: 700px;
            position: relative;
        }

        /* å…±é€šãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .btn {
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-am { background-color: var(--accent-blue); }
        .btn-pm { background-color: var(--accent-pink); }
        .btn-save { background-color: var(--accent-green); width: 100%; opacity: 0.5; pointer-events: none; }
        .btn-save.ready { opacity: 1; pointer-events: auto; }

        /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆæ§ãˆã‚ãªãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
        .btn-reset {
            background: transparent;
            color: #BBB;
            border: 1px solid #EEE;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .btn-reset:hover {
            background: #FFF0F0;
            color: #FF8888;
            border-color: #FFcccc;
        }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆç”¨ */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .screen.active { display: block; }

        /* --- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ --- */
        .start-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 2px solid #EEE;
        }
        .app-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--text-main);
        }
        .app-desc {
            margin-bottom: 30px;
            line-height: 1.6;
            color: var(--text-light);
        }
        .mode-select {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .mode-btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        .reset-area {
            border-top: 2px dashed #F0F0F0;
            padding-top: 20px;
            margin-top: 20px;
        }

        /* --- ãƒ¡ã‚¤ãƒ³æ—¥è¨˜ç”»é¢ --- */
        .diary-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            position: relative;
        }

        .question-section { text-align: center; margin-bottom: 25px; }
        .question-text { font-size: 1.4rem; margin-bottom: 15px; font-weight: bold; }
        
        .tags-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tag-chip {
            background: #F0F0F0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .tag-chip:hover { background: #E0E0E0; }
        .tag-chip.selected {
            background: #FFF;
            border-color: var(--accent-green);
            color: var(--accent-green);
            font-weight: bold;
            transform: scale(1.05);
        }

        /* æ¤ç‰©ã¨å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .input-section {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        .plant-viewer {
            width: 80px;
            height: 80px;
            background: #F9F9F9;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            flex-shrink: 0;
            border: 2px dashed #DDD;
            transition: all 0.5s ease;
        }
        .plant-viewer.bloomed {
            border-color: var(--accent-pink);
            background: #FFF0F0;
            animation: bounce 1s infinite;
        }

        .text-area-wrapper {
            flex: 1;
            position: relative;
        }
        textarea {
            width: 100%;
            height: 100px;
            border: 2px solid #DDD;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            resize: none;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s;
            line-height: 1.6;
        }
        textarea:focus { border-color: var(--accent-green); }
        textarea:disabled { background: #F5F5F5; }

        .char-counter {
            text-align: right;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        .feedback-text {
            text-align: center;
            min-height: 1.5em;
            color: var(--accent-green);
            font-weight: bold;
            margin: 15px 0;
        }

        /* --- å±¥æ­´ã‚¨ãƒªã‚¢ --- */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .history-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #DDD;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            gap: 15px;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }
        .history-item.am { border-left-color: var(--accent-blue); }
        .history-item.pm { border-left-color: var(--accent-pink); }
        
        .history-icon { font-size: 2rem; }
        .history-body { flex: 1; }
        .history-meta { font-size: 0.8rem; color: #999; margin-top: 5px; }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }

        .pop-in { animation: pop 0.4s ease forwards; }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 600px) {
            .input-section { flex-direction: column; align-items: center; }
            .mode-select { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- 1. ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <div id="startScreen" class="screen active">
        <div class="start-card">
            <h1 class="app-title">ğŸ“– ã‚³ãƒˆãƒã®ç®±åº­</h1>
            <p class="app-desc">
                å°‘ã—ã®æ™‚é–“ã§ã€ã“ã“ã‚ã‚’æ•´ç†ã™ã‚‹æ—¥è¨˜ã‚¢ãƒ—ãƒªã§ã™ã€‚<br>
                ç«¶äº‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ãªãŸã®ãƒšãƒ¼ã‚¹ã§ã€<br>
                è¨€è‘‰ã®ç¨®ã‚’ã¾ã„ã¦ã€èŠ±ã‚’å’²ã‹ã›ã¾ã—ã‚‡ã†ã€‚
            </p>
            <div class="mode-select">
                <div class="mode-btn-group">
                    <span>â˜€ï¸ æœã®æ™‚é–“ã«</span>
                    <button class="btn btn-am" onclick="startApp('am')">ä»Šæ—¥ã®è¨˜éŒ²ï¼ˆåˆå‰ï¼‰</button>
                </div>
                <div class="mode-btn-group">
                    <span>ğŸŒ™ å¸°ã‚Šã®ä¼šãªã©ã§</span>
                    <button class="btn btn-pm" onclick="startApp('pm')">ä»Šæ—¥ã®è¨˜éŒ²ï¼ˆåˆå¾Œï¼‰</button>
                </div>
            </div>

            <!-- åˆæœŸåŒ–ã‚¨ãƒªã‚¢ -->
            <div class="reset-area">
                <button class="btn-reset" onclick="resetDiary()">ã™ã¹ã¦ã®è¨˜éŒ²ã‚’æ¶ˆã—ã¦ã€ã¯ã˜ã‚ã‹ã‚‰ã«ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- 2. ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainScreen" class="screen">
        <header style="margin-bottom: 10px; text-align: center;">
            <button onclick="goHome()" style="background:none; border:none; color:#888; cursor:pointer;">â† æœ€åˆã®ç”»é¢ã«ã‚‚ã©ã‚‹</button>
        </header>

        <div class="diary-card">
            <!-- è³ªå•è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="question-section">
                <div class="question-text" id="questionText">è³ªå•ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
                <div class="tags-area" id="tagsArea">
                    <!-- ã‚¿ã‚°ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </div>

            <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="input-section">
                <div class="plant-viewer" id="plantViewer">ğŸŒ±</div>
                <div class="text-area-wrapper">
                    <textarea id="diaryInput" placeholder="ä¸Šã®è¨€è‘‰ã‚’é¸ã‚“ã§ã‹ã‚‰ã€ç¶šãã‚’æ›¸ã„ã¦ã¿ã‚ˆã†..." disabled></textarea>
                    <div class="char-counter">ç¾åœ¨: <span id="charCount">0</span>æ–‡å­— / ç›®æ¨™: <span id="targetCount">10</span>æ–‡å­—</div>
                </div>
            </div>

            <div class="feedback-text" id="feedbackText">ã¾ãšã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰é¸ã‚“ã§ã¿ã¦ã­</div>

            <button class="btn btn-save" id="saveBtn">æ—¥è¨˜ã‚’è¨˜éŒ²ã™ã‚‹</button>
        </div>

        <!-- å±¥æ­´ã‚¨ãƒªã‚¢ -->
        <div style="margin-bottom: 10px; font-weight: bold; color: var(--text-light);">ã“ã‚Œã¾ã§ã®è¨˜éŒ²</div>
        <div class="history-list" id="historyList">
            <!-- å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ  -->
        </div>
    </div>
</div>

<script>
    /* 
     * ã€å…ˆç”Ÿæ–¹ã¸ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨­å®šã€‘
     * ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜å…ˆã¯ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼ˆLocalStorageï¼‰ã§ã™ã€‚
     * ã€ŒåˆæœŸåŒ–ã€ã‚’è¡Œã†ã¨ã€ã“ã®ç«¯æœ«ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ãŒæ¶ˆãˆã¾ã™ã€‚
     */

    // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
    const QUESTIONS_AM = [
        { text: "æœã”ã¯ã‚“ã¯ ã©ã†ã ã£ãŸï¼Ÿ", tags: ["ãŠã„ã—ã‹ã£ãŸ", "ãŠãªã‹ã„ã£ã±ã„", "ã­ã‚€ã‹ã£ãŸ", "æ€¥ã„ã§é£Ÿã¹ãŸ", "é£Ÿã¹ã¦ã„ãªã„", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        { text: "ä»Šã®æ°—åˆ†ã¯ï¼Ÿ", tags: ["å…ƒæ°—ã„ã£ã±ã„", "ã¡ã‚‡ã£ã¨ã­ã‚€ã„", "ã‚ãã‚ã", "ãŠã¡ã¤ã„ã¦ã„ã‚‹", "ãµã¤ã†", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        { text: "å­¦æ ¡ã«æ¥ã‚‹æ™‚ã€ãªã«ã‹è¦‹ã¤ã‘ãŸï¼Ÿ", tags: ["ãã‚Œã„ãªèŠ±", "è™«", "ã¨ã‚‚ã ã¡", "é’ã„ç©º", "ãªã«ã‚‚ãªã—", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        {"text":"å­¦æ ¡ã«ç€ã„ãŸä»Šã®æ°—åˆ†ã¯ï¼Ÿ","tags":["å…ƒæ°—","è½ã¡ç€ã„ã¦ã„ã‚‹","ã‚„ã‚‹æ°—ãŒã‚ã‚‹","ã‚ãã‚ã","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ç™»æ ¡ã—ã¦æœ€åˆã«ã—ãŸã“ã¨ã¯ï¼Ÿ","tags":["ã‚ã„ã•ã¤ã—ãŸ","å¸­ã«ç€ã„ãŸ","æº–å‚™ã‚’ã—ãŸ","å‹ã ã¡ã¨è©±ã—ãŸ","é™ã‹ã«éã”ã—ãŸ","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æ•™å®¤ã®é›°å›²æ°—ã¯ã©ã†æ„Ÿã˜ãŸï¼Ÿ","tags":["æ˜ã‚‹ã„","è½ã¡ç€ã„ã¦ã„ã‚‹","ã«ãã‚„ã‹","å®‰å¿ƒã™ã‚‹","é›†ä¸­ã§ããã†","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã®è‡ªåˆ†ã®æ§˜å­ã«è¿‘ã„ã®ã¯ï¼Ÿ","tags":["å…ƒæ°—","ãƒã‚¤ãƒšãƒ¼ã‚¹","å‰å‘ã","è½ã¡ç€ã„ã¦ã„ã‚‹","åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚ŒãŸ","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ç™»æ ¡ä¸­ã«å°è±¡ã«æ®‹ã£ãŸã“ã¨ã¯ï¼Ÿ","tags":["å¤©æ°—","å‹ã ã¡","é“ã®æ§˜å­","å®‰å…¨ã«æ¥ã‚‰ã‚ŒãŸ","ç‰¹ã«ãªã„","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã€æˆæ¥­ã¸ã®æ°—æŒã¡ã¯ï¼Ÿ","tags":["æ¥½ã—ã¿","ãŒã‚“ã°ã‚Œãã†","é›†ä¸­ã—ãŸã„","ã„ã¤ã‚‚é€šã‚Š","å°‘ã—æœŸå¾…","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã®æº–å‚™ã¯ã©ã†ã ã£ãŸï¼Ÿ","tags":["ã—ã£ã‹ã‚Šã§ããŸ","ã ã„ãŸã„ã§ããŸ","è½ã¡ç€ã„ã¦ã§ããŸ","æ—©ã‚ã«ã§ããŸ","å•é¡Œãªã‹ã£ãŸ","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã®ä½“ã®èª¿å­ã¯ï¼Ÿ","tags":["å…ƒæ°—","èª¿å­ãŒã„ã„","å‹•ãã‚„ã™ã„","ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã„ã‚‹","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã«ã§ãã¦ã‚ˆã‹ã£ãŸã“ã¨ã¯ï¼Ÿ","tags":["æ™‚é–“ã‚’å®ˆã‚ŒãŸ","å¿˜ã‚Œç‰©ãªã—","ã‚ã„ã•ã¤","æº–å‚™","ç™»æ ¡","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šæ—¥ã®åˆå‰ä¸­ã«å‘ã‘ãŸæ°—æŒã¡ã¯ï¼Ÿ","tags":["å‰å‘ã","ãŒã‚“ã°ã‚ŠãŸã„","è½ã¡ç€ã„ã¦éã”ã—ãŸã„","æ¥½ã—ã¿","ä¸€ã¤ãšã¤ã‚„ã‚‹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã„ã‚‹å ´æ‰€ã§ç›®ã«å…¥ã£ãŸã‚‚ã®ã¯ï¼Ÿ","tags":["é»’æ¿","çª“ã®å¤–","å‹ã ã¡","è‡ªåˆ†ã®å¸­","æ²ç¤ºç‰©","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æ•™å®¤ã«å…¥ã£ã¦æ„Ÿã˜ãŸã“ã¨ã¯ï¼Ÿ","tags":["å®‰å¿ƒ","è½ã¡ç€ã","é›†ä¸­ã§ããã†","æ˜ã‚‹ã„","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã®ã‚ã„ã•ã¤ã¯ã©ã†ã ã£ãŸï¼Ÿ","tags":["æ°—æŒã¡ã‚ˆãã§ããŸ","è‡ªåˆ†ã‹ã‚‰ã§ããŸ","å£°ã‚’å‡ºã›ãŸ","èã‘ãŸ","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã®è‡ªåˆ†ã®å§¿å‹¢ã‚„æ§˜å­ã¯ï¼Ÿ","tags":["è½ã¡ç€ã„ã¦ã„ã‚‹","æº–å‚™ãŒã§ãã¦ã„ã‚‹","å‰ã‚’å‘ã„ã¦ã„ã‚‹","ãƒªãƒ©ãƒƒã‚¯ã‚¹","æ•´ã£ã¦ã„ã‚‹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã®æ™‚é–“ã‚’ã©ã†ä½¿ãˆã¦ã„ã‚‹ï¼Ÿ","tags":["æº–å‚™","ç¢ºèª","å¾…ã¡æ™‚é–“","é™ã‹ã«éã”ã™","è€ƒãˆã”ã¨","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã€é ­ã«æµ®ã‹ã‚“ã§ã„ã‚‹ã“ã¨ã¯ï¼Ÿ","tags":["ä»Šæ—¥ã®äºˆå®š","æˆæ¥­","å‹ã ã¡","ã‚„ã‚‹ã“ã¨","æ¥½ã—ã¿ãªã“ã¨","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šæ—¥ã®åˆå‰ä¸­ã«å¤§åˆ‡ã«ã—ãŸã„ã“ã¨ã¯ï¼Ÿ","tags":["é›†ä¸­","ã¦ã„ã­ã„","è©±ã‚’èã","æŒ‘æˆ¦","ãƒã‚¤ãƒšãƒ¼ã‚¹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æœã®è‡ªåˆ†ã‚’ã»ã‚ã‚‹ã¨ã—ãŸã‚‰ï¼Ÿ","tags":["æ¥ã‚‰ã‚ŒãŸ","æº–å‚™ã—ãŸ","åˆ‡ã‚Šæ›¿ãˆãŸ","åº§ã‚ŒãŸ","ãŒã‚“ã°ã£ã¦ã„ã‚‹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ã“ã‚Œã‹ã‚‰æœ€åˆã«ã‚„ã‚‹ã“ã¨ã¯ï¼Ÿ","tags":["æˆæ¥­ã®æº–å‚™","ãƒãƒ¼ãƒˆã‚’å‡ºã™","è©±ã‚’èã","é»’æ¿ã‚’è¦‹ã‚‹","é™ã‹ã«å¾…ã¤","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šæ—¥ã‚’ã©ã‚“ãªä¸€æ—¥ã«ã—ãŸã„ï¼Ÿ","tags":["è½ã¡ç€ã„ãŸæ—¥","å­¦ã³ã®ã‚ã‚‹æ—¥","æ¥½ã—ã„æ—¥","ã‚„ã‚Šãã‚‹æ—¥","ã„ã¤ã‚‚é€šã‚Šã®æ—¥","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]}

    ];

    const QUESTIONS_PM = [
        { text: "ä»Šæ—¥ã®çµ¦é£Ÿã¯ ã©ã†ã ã£ãŸï¼Ÿ", tags: ["ãŠã„ã—ã‹ã£ãŸ", "ã™ããªãƒ¡ãƒ‹ãƒ¥ãƒ¼", "ã«ãŒã¦ã ã£ãŸ", "ãŠã‹ã‚ã‚Šã—ãŸ", "æ®‹ã—ã¦ã—ã¾ã£ãŸ", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        { text: "å®¶ã«å¸°ã£ãŸã‚‰ ä½•ã‚’ã™ã‚‹ï¼Ÿ", tags: ["å®¿é¡Œã‚’ã™ã‚‹", "ã‚ãã³ã«è¡Œã", "ã‚²ãƒ¼ãƒ ã‚’ã™ã‚‹", "æœ¬ã‚’èª­ã‚€", "ç¿’ã„äº‹", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        { text: "ä»Šæ—¥ã®æˆæ¥­ã§æ¥½ã—ã‹ã£ãŸã®ã¯ï¼Ÿ", tags: ["å›½èª", "ç®—æ•°", "ä½“è‚²", "å›³å·¥", "éŸ³æ¥½", "ä¼‘ã¿æ™‚é–“", "ã‚ã¦ã¯ã¾ã‚‰ãªã„"] },
        {"text":"åˆå¾ŒãŒå§‹ã¾ã£ãŸä»Šã®æ°—åˆ†ã¯ï¼Ÿ","tags":["è½ã¡ç€ã„ã¦ã„ã‚‹","åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚ŒãŸ","å‰å‘ã","å…ƒæ°—","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"æ˜¼ä¼‘ã¿ã®ã‚ã¨ã€æœ€åˆã«ã—ãŸã“ã¨ã¯ï¼Ÿ","tags":["æº–å‚™ã‚’ã—ãŸ","å¸­ã«ç€ã„ãŸ","è©±ã‚’èã„ãŸ","æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆãŸ","é™ã‹ã«éã”ã—ãŸ","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®æ•™å®¤ã®é›°å›²æ°—ã¯ã©ã†ï¼Ÿ","tags":["è½ã¡ç€ã„ã¦ã„ã‚‹","é›†ä¸­ã§ããã†","ã«ãã‚„ã‹","å®‰å¿ƒã™ã‚‹","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®æˆæ¥­ã¸ã®æ°—æŒã¡ã¯ï¼Ÿ","tags":["ãŒã‚“ã°ã‚Œãã†","é›†ä¸­ã—ãŸã„","æ¥½ã—ã¿","ä¸€ã¤ãšã¤ã‚„ã‚‹","å‰å‘ã","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šã®ä½“ã®æ§˜å­ã«è¿‘ã„ã®ã¯ï¼Ÿ","tags":["å…ƒæ°—","å‹•ãã‚„ã™ã„","ãƒªãƒ©ãƒƒã‚¯ã‚¹","è½ã¡ç€ã„ã¦ã„ã‚‹","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã«å¤§åˆ‡ã«ã—ãŸã„ã“ã¨ã¯ï¼Ÿ","tags":["é›†ä¸­","ã¦ã„ã­ã„","æœ€å¾Œã¾ã§","è©±ã‚’èã","ãƒã‚¤ãƒšãƒ¼ã‚¹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã«ã§ããã†ã ã¨æ€ã†ã“ã¨ã¯ï¼Ÿ","tags":["æˆæ¥­","ä½œæ¥­","ç™ºè¡¨","è©±ã‚’èã","ãƒãƒ¼ãƒˆã‚’æ›¸ã","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®è‡ªåˆ†ã®æ§˜å­ã¯ã©ã‚Œã«è¿‘ã„ï¼Ÿ","tags":["å‰å‘ã","è½ã¡ç€ã„ã¦ã„ã‚‹","åˆ‡ã‚Šæ›¿ãˆã§ãã¦ã„ã‚‹","ãŒã‚“ã°ã‚Šãƒ¢ãƒ¼ãƒ‰","è‡ªç„¶ä½“","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã«æ¥½ã—ã¿ã«ã—ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ","tags":["æˆæ¥­","æ´»å‹•","å‹ã ã¡","ä¸‹æ ¡","ä¸€æ—¥ã®ã¾ã¨ã‚","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®æ™‚é–“ã®ä½¿ã„æ–¹ã¯ï¼Ÿ","tags":["é›†ä¸­ã™ã‚‹","ã‚†ã£ãã‚Šé€²ã‚ã‚‹","ä¸€ã¤ãšã¤","è©±ã‚’èã","æµã‚Œã«ã®ã‚‹","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã«æ„è­˜ã—ãŸã„è‡ªåˆ†ã®è¡Œå‹•ã¯ï¼Ÿ","tags":["å§¿å‹¢","ã‚ã„ã•ã¤","èã","æ‰‹ã‚’å‹•ã‹ã™","æœ€å¾Œã¾ã§","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®ä»Šã€è‡ªåˆ†ã«å£°ã‚’ã‹ã‘ã‚‹ãªã‚‰ï¼Ÿ","tags":["ã“ã®ã¾ã¾ã§ã„ã„","ä¸€ã¤ãšã¤","å¤§ä¸ˆå¤«","ãŒã‚“ã°ã‚ã†","è½ã¡ç€ã„ã¦","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä»Šæ—¥ã®å¾ŒåŠã§ç›®æ¨™ã«ã—ãŸã„ã“ã¨ã¯ï¼Ÿ","tags":["ã‚„ã‚Šãã‚‹","é›†ä¸­","å­¦ã¶","è½ã¡ç€ã","æ¥½ã—ã‚€","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"åˆå¾Œã®å­¦æ ¡ç”Ÿæ´»ã‚’ä¸€è¨€ã§è¡¨ã™ã¨ï¼Ÿ","tags":["è½ã¡ç€ã","é›†ä¸­","å‰å‘ã","å……å®Ÿ","ã„ã¤ã‚‚é€šã‚Š","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]},
        {"text":"ä¸‹æ ¡ã«å‘ã‘ã¦ä»Šã®æ°—æŒã¡ã¯ï¼Ÿ","tags":["ã‚„ã‚Šãã‚ŠãŸã„","ã“ã®ã¾ã¾ç¶šã‘ãŸã„","è½ã¡ç€ã„ã¦ã„ã‚‹","å‰å‘ã","ä¸€æ—¥ã‚’ã¾ã¨ã‚ãŸã„","ã‚ã¦ã¯ã¾ã‚‰ãªã„"]}
    ];

    const STORAGE_KEY = 'kotoba_garden_diary_v2';

    // --- çŠ¶æ…‹ç®¡ç† ---
    let currentMode = 'am'; // 'am' or 'pm'
    let currentQuestion = null;
    let selectedTag = null;
    let recordHigh = 10; // éå»ã®æœ€é«˜æ–‡å­—æ•°ï¼ˆåˆæœŸå€¤ï¼‰

    // --- DOMè¦ç´  ---
    const startScreen = document.getElementById('startScreen');
    const mainScreen = document.getElementById('mainScreen');
    const questionText = document.getElementById('questionText');
    const tagsArea = document.getElementById('tagsArea');
    const diaryInput = document.getElementById('diaryInput');
    const plantViewer = document.getElementById('plantViewer');
    const charCountEl = document.getElementById('charCount');
    const targetCountEl = document.getElementById('targetCount');
    const feedbackText = document.getElementById('feedbackText');
    const saveBtn = document.getElementById('saveBtn');
    const historyList = document.getElementById('historyList');

    // --- åˆæœŸåŒ– ---
    function init() {
        updateRecordHigh();
        renderHistory();
    }

    // éå»ã®æœ€é«˜è¨˜éŒ²ã‚’æ›´æ–°
    function updateRecordHigh() {
        const data = loadData();
        if (data.length > 0) {
            // éå»ã®ãƒ­ã‚°ã‹ã‚‰æœ€å¤§æ–‡å­—æ•°ã‚’æ¢ã™
            const max = Math.max(...data.map(d => d.count));
            recordHigh = max > 10 ? max : 10;
        } else {
            recordHigh = 10; // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
        }
    }

    // ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰
    window.resetDiary = function() {
        if(confirm("ã“ã‚Œã¾ã§ã®æ—¥è¨˜ãŒã™ã¹ã¦æ¶ˆãˆã¾ã™ã€‚\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            alert("è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
            init(); // ç”»é¢ã‚’æ›´æ–°
        }
    };

    // --- ã‚¢ãƒ—ãƒªé–‹å§‹ãƒ•ãƒ­ãƒ¼ ---
    window.startApp = function(mode) {
        currentMode = mode;
        startScreen.classList.remove('active');
        mainScreen.classList.add('active');
        
        // è³ªå•ã‚’ã‚»ãƒƒãƒˆ
        const qList = mode === 'am' ? QUESTIONS_AM : QUESTIONS_PM;
        currentQuestion = qList[Math.floor(Math.random() * qList.length)];
        
        renderQuestion();
        resetInput();
        
        // ç›®æ¨™è¨­å®šï¼ˆå‰å›ã®è¨˜éŒ² + ã¡ã‚‡ã£ã¨ï¼‰
        targetCountEl.textContent = recordHigh;
    };

    window.goHome = function() {
        mainScreen.classList.remove('active');
        startScreen.classList.add('active');
    };

    function renderQuestion() {
        questionText.textContent = currentQuestion.text;
        tagsArea.innerHTML = '';
        
        currentQuestion.tags.forEach(tag => {
            const btn = document.createElement('div');
            btn.className = 'tag-chip';
            btn.textContent = tag;
            btn.onclick = () => selectTag(btn, tag);
            tagsArea.appendChild(btn);
        });
    }

    function resetInput() {
        selectedTag = null;
        diaryInput.value = '';
        diaryInput.disabled = true; // ã‚¿ã‚°é¸æŠã¾ã§ç„¡åŠ¹åŒ–
        plantViewer.textContent = 'ğŸŒ±';
        plantViewer.className = 'plant-viewer'; // ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆ
        charCountEl.textContent = '0';
        feedbackText.textContent = 'ã¾ãšã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰é¸ã‚“ã§ã¿ã¦ã­';
        saveBtn.classList.remove('ready');
    }

    // --- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ ---
    function selectTag(element, tag) {
        // è¦‹ãŸç›®ã®æ›´æ–°
        document.querySelectorAll('.tag-chip').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        
        selectedTag = tag;
        diaryInput.disabled = false;
        diaryInput.focus();
        
        if (tag === 'ã‚ã¦ã¯ã¾ã‚‰ãªã„') {
            feedbackText.textContent = 'ã©ã‚“ãªæ°—æŒã¡ã‹ã€è‡ªç”±ã«æ›¸ã„ã¦ã¿ã‚ˆã†';
            diaryInput.placeholder = 'ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¥åŠ›...';
        } else {
            feedbackText.textContent = `ã€Œ${tag}ã€ãªã‚“ã ã­ã€‚ãã‚ã—ãæ•™ãˆã¦ï¼Ÿ`;
            diaryInput.placeholder = `ã€Œ${tag}ã€ã¨æ€ã£ãŸã®ã¯ã©ã†ã—ã¦ã‹ãª...`;
        }

        updatePlant(0); // ãƒªã‚»ãƒƒãƒˆã§ã¯ãªãç¾çŠ¶ç¶­æŒç¢ºèª
        checkSaveReady();
    }

    diaryInput.addEventListener('input', () => {
        const len = diaryInput.value.length;
        charCountEl.textContent = len;
        updatePlant(len);
        checkSaveReady();
    });

    // æ¤ç‰©ã®æˆé•·ãƒ­ã‚¸ãƒƒã‚¯
    function updatePlant(len) {
        // ã‚¹ãƒ†ãƒ¼ã‚¸è¨ˆç®—: ç¾åœ¨æ–‡å­—æ•° / ç›®æ¨™æ–‡å­—æ•°
        const progress = len / recordHigh;
        let icon = 'ğŸŒ±'; // ç¨®
        let isBloomed = false;

        if (len === 0) icon = 'ğŸŒ±';
        else if (len < 3) icon = 'ğŸŒ¿'; // èŠ½ï¼ˆæ›¸ãå§‹ã‚ï¼‰
        else if (progress < 0.5) icon = 'ğŸƒ'; // ãƒ„ãƒ«ï¼ˆä¼¸ã³ã¦ããŸï¼‰
        else if (progress < 1.0) icon = 'ğŸŒ·'; // ã¤ã¼ã¿ï¼ˆã‚‚ã†ã™ãï¼‰
        else if (progress >= 1.0) {
            icon = 'ğŸŒ¸'; // é–‹èŠ±ï¼ˆç›®æ¨™é”æˆï¼ï¼‰
            isBloomed = true;
        }
        
        // éå»æœ€é«˜ã‚’å¤§ããè¶…ãˆãŸå ´åˆã®ç‰¹åˆ¥æ¼”å‡ºï¼ˆæº€é–‹ï¼‰
        if (len > recordHigh * 1.2) {
            icon = 'ğŸ’';
        }

        // ã‚¢ã‚¤ã‚³ãƒ³ãŒå¤‰ã‚ã£ãŸæ™‚ã ã‘ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        if (plantViewer.textContent !== icon) {
            plantViewer.textContent = icon;
            plantViewer.classList.remove('pop-in');
            void plantViewer.offsetWidth; // ãƒªãƒ•ãƒ­ãƒ¼
            plantViewer.classList.add('pop-in');
        }

        // æº€é–‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        if (isBloomed) {
            plantViewer.classList.add('bloomed');
            feedbackText.textContent = len > recordHigh * 1.2 
                ? 'ã™ã”ã„ï¼ ä»Šã¾ã§ã®è‡ªåˆ†ã‚’è¶…ãˆãŸã­ï¼' 
                : 'ç›®æ¨™é”æˆï¼ ãã‚Œã„ãªèŠ±ãŒå’²ã„ãŸã‚ˆ';
            feedbackText.style.color = '#E91E63'; // ãƒ”ãƒ³ã‚¯è‰²ã§å¼·èª¿
        } else if (len > 0) {
            feedbackText.textContent = 'ãã®èª¿å­ã€ã‚‚ã£ã¨è‚²ã¦ã¦ã¿ã‚ˆã†';
            feedbackText.style.color = 'var(--accent-green)';
        }
    }

    function checkSaveReady() {
        const hasText = diaryInput.value.trim().length > 0;
        if (selectedTag && hasText) {
            saveBtn.classList.add('ready');
        } else {
            saveBtn.classList.remove('ready');
        }
    }

    // --- ä¿å­˜å‡¦ç† ---
    saveBtn.addEventListener('click', () => {
        const text = diaryInput.value;
        const count = text.length;
        
        const entry = {
            id: Date.now(),
            date: new Date().toLocaleDateString('ja-JP') + ' ' + (currentMode === 'am' ? 'åˆå‰' : 'åˆå¾Œ'),
            mode: currentMode,
            tag: selectedTag,
            text: text,
            count: count
        };

        const data = loadData();
        data.unshift(entry);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

        // å®Œäº†æ¼”å‡º
        alert(`è¨˜éŒ²ã—ã¾ã—ãŸï¼\næ–‡å­—æ•°: ${count}æ–‡å­—\nãŠèŠ±ãŒè‚²ã¡ã¾ã—ãŸã­ğŸŒ¸`);
        
        // çŠ¶æ…‹æ›´æ–°
        updateRecordHigh();
        renderHistory();
        goHome();
    });

    // --- å±¥æ­´è¡¨ç¤º ---
    function loadData() {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    }

    function renderHistory() {
        const data = loadData();
        historyList.innerHTML = '';
        
        if (data.length === 0) {
            historyList.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>æœ€åˆã®æ—¥è¨˜ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ï¼</div>';
            return;
        }

        data.forEach(item => {
            const div = document.createElement('div');
            div.className = `history-item ${item.mode}`; // am or pm
            
            // ã‚¢ã‚¤ã‚³ãƒ³æ±ºå®šï¼ˆæ–‡å­—æ•°ã«å¿œã˜ã¦ï¼‰
            let icon = 'ğŸŒ±';
            if (item.count > 20) icon = 'ğŸ’';
            else if (item.count > 10) icon = 'ğŸŒ¸';
            else if (item.count > 5) icon = 'ğŸŒ·';
            else icon = 'ğŸŒ¿';

            div.innerHTML = `
                <div class="history-icon">${icon}</div>
                <div class="history-body">
                    <div style="font-weight:bold; color:var(--text-main);">
                        ${item.tag} <span style="font-weight:normal; font-size:0.9em;">(${item.count}æ–‡å­—)</span>
                    </div>
                    <div style="margin-top:5px;">${item.text}</div>
                    <div class="history-meta">${item.date}</div>
                </div>
            `;
            historyList.appendChild(div);
        });
    }

    // èµ·å‹•æ™‚
    init();

</script>
</body>
</html>