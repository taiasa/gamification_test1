<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Indian Math Master - インド式計算マスター</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                        mono: ['"Roboto Mono"', 'monospace'],
                    },
                    colors: {
                        bg: '#F8FAFC', // Slate 50
                        surface: '#FFFFFF',
                        brand: {
                            500: '#6366F1', // Indigo
                            600: '#4F46E5',
                            soft: '#EEF2FF',
                        },
                        accent: {
                            500: '#10B981', // Emerald
                            600: '#059669',
                        },
                        warn: {
                            500: '#F59E0B',
                        },
                        error: {
                            500: '#EF4444',
                        }
                    },
                    animation: {
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                        'pop': 'pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0.5' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    },
                    boxShadow: {
                        'soft': '0 2px 10px rgba(0,0,0,0.05)',
                        'key': '0 3px 0 #CBD5E1', 
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F8FAFC;
            color: #334155;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
            user-select: none;
            overflow: hidden; /* Prevent body scroll */
        }
        /* Mobile height fix */
        .app-height {
            height: 100vh; /* Fallback */
            height: 100dvh;
        }
        .key-btn {
            position: relative;
            background: white;
            border-radius: 0.75rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            font-size: 1.25rem;
            color: #475569;
            box-shadow: 0 3px 0 #E2E8F0;
            border: 1px solid #F1F5F9;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }
        .key-btn:active, .key-btn.active {
            transform: translateY(3px);
            box-shadow: none;
            background-color: #F1F5F9;
        }
        .blink-caret {
            animation: blink 1s step-end infinite;
            border-right: 2px solid #6366F1;
        }
        @keyframes blink { 0%, 100% { border-color: transparent; } 50% { border-color: #6366F1; } }
    </style>
</head>
<body class="app-height flex flex-col font-sans">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-30 border-b border-slate-100 h-12 flex-none">
        <div class="max-w-md mx-auto px-4 h-full flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="app.goHome()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-brand-500"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
                <h1 class="text-sm font-bold text-slate-700 tracking-tight">インド式計算マスター</h1>
            </div>
            <button onclick="app.startChallenge()" class="text-xs font-bold bg-slate-700 text-white px-3 py-1 rounded-full hover:bg-slate-600 transition-colors">
                総合テスト
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-root" class="flex-grow w-full max-w-md mx-auto relative overflow-hidden flex flex-col">
        <!-- Views injected here -->
    </main>

    <!-- Sound Engine -->
    <script>
        const Sound = {
            ctx: null,
            init: () => {
                if (!Sound.ctx) Sound.ctx = new (window.AudioContext || window.webkitAudioContext)();
            },
            play: (type) => {
                Sound.init();
                if (Sound.ctx.state === 'suspended') Sound.ctx.resume();
                const t = Sound.ctx.currentTime;
                const osc = Sound.ctx.createOscillator();
                const gain = Sound.ctx.createGain();
                osc.connect(gain);
                gain.connect(Sound.ctx.destination);

                if (type === 'correct') {
                    osc.type = 'sine'; 
                    osc.frequency.setValueAtTime(660, t); 
                    osc.frequency.setValueAtTime(880, t + 0.1); 
                    gain.gain.setValueAtTime(0.1, t);
                    gain.gain.linearRampToValueAtTime(0.3, t + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.4);
                    osc.start(t);
                    osc.stop(t + 0.4);
                } else if (type === 'wrong') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, t);
                    gain.gain.setValueAtTime(0.1, t);
                    gain.gain.linearRampToValueAtTime(0.2, t + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                    osc.start(t);
                    osc.stop(t + 0.3);
                } else if (type === 'tap') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(600, t);
                    gain.gain.setValueAtTime(0.05, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.05);
                    osc.start(t);
                    osc.stop(t + 0.05);
                }
            }
        };

        // --- Data ---
        const TECHNIQUES = [
            {
                id: 't1', title: '11〜19の掛け算', subtitle: 'おみやげ算',
                desc: '10代同士の掛け算', example: '13×12',
                color: 'text-indigo-600 bg-indigo-50',
                generate: () => ({ num1: Math.floor(Math.random()*9)+11, num2: Math.floor(Math.random()*9)+11, ans: 0, get calc(){return this.num1*this.num2} }),
                explain: (n1, n2) => {
                    const u2 = n2 % 10, sum = n1 + u2;
                    return [
                        { text: `前の数「${n1}」に、後ろの1の位「${u2}」を足します。`, math: `${n1} + ${u2} = ${sum}` },
                        { text: `その答えを10倍します。`, math: `${sum} × 10 = ${sum}0` },
                        { text: `一の位同士を掛け合わせます。`, math: `${n1%10} × ${u2} = ${(n1%10)*u2}` },
                        { text: `足し合わせれば答えです。`, math: `${sum}0 + ${(n1%10)*u2} = ${n1*n2}`, highlight: true }
                    ];
                }
            },
            {
                id: 't2', title: '一の位が5の数の2乗<br>（2乗：同じ数同士のかけ算）', subtitle: '一瞬の2乗',
                desc: '同じ数の掛け算', example: '35×35',
                color: 'text-emerald-600 bg-emerald-50',
                generate: () => { const n = Math.floor(Math.random()*9)+1; const num = n*10+5; return { num1: num, num2: num, ans: num*num }; },
                explain: (n1, n2) => {
                    const t = Math.floor(n1/10);
                    return [
                        { text: `十の位「${t}」に注目します。`, math: `十の位: ${t}` },
                        { text: `その数に1を足した数を掛けます。`, math: `${t} × ${t+1} = ${t*(t+1)}` },
                        { text: `末尾に「25」をつけるだけです。`, math: `答え: ${t*(t+1)}25`, highlight: true }
                    ];
                }
            },
            {
                id: 't3', title: '100に近い数同士のかけ算', subtitle: '大きな数の計算',
                desc: '90代同士の掛け算', example: '97×96',
                color: 'text-amber-600 bg-amber-50',
                generate: () => { const a = Math.floor(Math.random()*9)+91; const b = Math.floor(Math.random()*9)+91; return { num1: a, num2: b, ans: a*b }; },
                explain: (n1, n2) => {
                    const d1 = 100-n1, d2 = 100-n2;
                    return [
                        { text: `100からの不足分を求めます。`, math: `-${d1}, -${d2}` },
                        { text: `斜めに引き算をします。`, math: `${n1} - ${d2} = ${n1-d2}` },
                        { text: `不足分同士を掛けます。`, math: `${d1} × ${d2} = ${d1*d2 < 10 ? '0'+(d1*d2) : d1*d2}` },
                        { text: `並べれば答えです。`, math: `答え: ${n1-d2}${d1*d2 < 10 ? '0'+(d1*d2) : d1*d2}`, highlight: true }
                    ];
                }
            },
            {
                id: 't4', title: '11の掛け算', subtitle: 'サンドイッチ',
                desc: 'どんな数×11', example: '42×11',
                color: 'text-purple-600 bg-purple-50',
                generate: () => { const a = Math.floor(Math.random()*89)+10; return { num1: a, num2: 11, ans: a*11 }; },
                explain: (n1, n2) => {
                    const t = Math.floor(n1/10), u = n1%10, s = t+u;
                    return s < 10 
                        ? [{ text: `数字を左右に広げます。`, math: `${t} _ ${u}` }, { text: `和を真ん中に挟みます。`, math: `答え: ${t}${s}${u}`, highlight: true }]
                        : [{ text: `和を求めます。`, math: `${t} + ${u} = ${s}` }, { text: `十の位に繰り上げます。`, math: `答え: ${t+1}${s%10}${u}`, highlight: true }];
                }
            }
        ];

        // --- State ---
        const state = {
            mode: 'home',
            techId: null,
            problem: null,
            studyStep: 0,
            score: 0,
            questionCount: 0,
            history: [],
            inputBuffer: ''
        };
        const appRoot = document.getElementById('app-root');

        // --- Logic ---
        const app = {
            goHome: () => { state.mode = 'home'; app.render(); },
            selectTechnique: (id) => { state.techId = id; state.mode = 'menu'; app.render(); },
            openStudy: () => {
                state.mode = 'study'; state.studyStep = 0;
                const tech = TECHNIQUES.find(t => t.id === state.techId);
                state.problem = { ...tech.generate() };
                if(!state.problem.ans && state.problem.calc) state.problem.ans = state.problem.calc; 
                app.render();
            },
            nextStep: () => { state.studyStep++; app.render(); },
            prevStep: () => { if(state.studyStep > 0) state.studyStep--; app.render(); },
            
            startPractice: (techId = null) => {
                state.mode = 'practice';
                if(techId) state.techId = techId;
                state.inputBuffer = '';
                app.newProblem();
                app.render();
            },
            startChallenge: () => {
                state.mode = 'challenge'; state.score = 0; state.questionCount = 1; state.history = []; state.techId = null; state.inputBuffer = '';
                app.newProblem(true);
                app.render();
            },
            newProblem: (random = false) => {
                const tech = random ? TECHNIQUES[Math.floor(Math.random()*TECHNIQUES.length)] : TECHNIQUES.find(t => t.id === state.techId);
                const p = tech.generate();
                state.problem = { ...p, ans: p.ans || p.calc, technique: tech };
            },
            handleInput: (char) => {
                Sound.play('tap');
                if(char === 'C') state.inputBuffer = '';
                else if(char === 'BS') state.inputBuffer = state.inputBuffer.slice(0, -1);
                else if(state.inputBuffer.length < 5) state.inputBuffer += char;
                app.updateDisplay();
            },
            updateDisplay: () => {
                const el = document.getElementById('input-display');
                if(el) {
                    el.innerText = state.inputBuffer;
                    el.className = state.inputBuffer ? "text-3xl font-mono font-bold text-slate-800" : "text-3xl font-mono font-bold text-slate-800 blink-caret h-8";
                }
            },
            checkPractice: () => {
                if(!state.inputBuffer) return;
                const correct = parseInt(state.inputBuffer) === state.problem.ans;
                if(correct) {
                    Sound.play('correct');
                    const fb = document.getElementById('feedback');
                    fb.innerHTML = `<div class="text-emerald-500 font-bold text-5xl animate-pop">〇</div>`;
                    fb.classList.remove('hidden');
                    setTimeout(() => { state.inputBuffer = ''; app.newProblem(); app.render(); }, 800);
                } else {
                    Sound.play('wrong');
                    const box = document.getElementById('input-box');
                    box.classList.remove('animate-shake');
                    void box.offsetWidth; 
                    box.classList.add('animate-shake', 'border-red-400', 'bg-red-50');
                    setTimeout(() => box.classList.remove('border-red-400', 'bg-red-50'), 500);
                }
            },
            submitChallenge: () => {
                if(!state.inputBuffer) return;
                const val = parseInt(state.inputBuffer);
                const correct = val === state.problem.ans;
                Sound.play(correct ? 'correct' : 'wrong');
                state.history.push({ ...state.problem, correct, userAns: val });
                if(correct) state.score++;
                
                const fb = document.getElementById('feedback');
                fb.innerHTML = correct ? `<div class="text-emerald-500 font-bold text-5xl animate-pop">〇</div>` : `<div class="text-red-500 font-bold text-5xl animate-pop">×</div>`;
                fb.classList.remove('hidden');
                setTimeout(() => { state.inputBuffer = ''; app.nextChallenge(); }, 800);
            },
            nextChallenge: () => {
                if(state.questionCount >= 10) { state.mode = 'result'; app.render(); }
                else { state.questionCount++; app.newProblem(true); app.render(); }
            },
            render: () => {
                appRoot.innerHTML = View[state.mode] ? View[state.mode]() : View.Home();
            }
        };

        // --- Views ---
        const NumPad = (action) => `
            <div class="grid grid-cols-3 gap-2 p-3 bg-slate-50 border-t border-slate-200 mt-auto flex-none">
                ${[7,8,9,4,5,6,1,2,3].map(n => `<button class="key-btn h-12 sm:h-14" onclick="app.handleInput('${n}')">${n}</button>`).join('')}
                <button class="key-btn h-12 sm:h-14 text-slate-400" onclick="app.handleInput('C')">C</button>
                <button class="key-btn h-12 sm:h-14" onclick="app.handleInput('0')">0</button>
                <button class="key-btn h-12 sm:h-14 bg-brand-500 text-white !border-brand-600 !shadow-brand-600" onclick="${action}">OK</button>
            </div>`;

        const View = {
            Home: () => `
                <div class="p-4 overflow-y-auto h-full pb-20">
                    <div class="text-center mb-4">
                        <h2 class="text-lg font-bold text-slate-800">計算は、パズルだ</h2>
                        <p class="text-xs text-slate-500">４つのテクニックを極めよう</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3 h-full content-start">
                        ${TECHNIQUES.map(t => `
                            <button onclick="app.selectTechnique('${t.id}')" class="bg-white p-3 rounded-xl shadow-soft border border-slate-100 flex flex-col justify-between h-32 active:scale-95 transition-transform text-left relative overflow-hidden group">
                                <div class="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <span class="text-4xl font-bold ${t.color.split(' ')[0]}">${t.id.replace('t','')}</span>
                                </div>
                                <div>
                                    <div class="text-xs font-bold ${t.color.split(' ')[0]} mb-1">${t.subtitle}</div>
                                    <h3 class="font-bold text-slate-800 text-sm leading-tight mb-1">${t.title}</h3>
                                </div>
                                <div class="text-[10px] text-slate-400 border-t border-slate-50 pt-2 flex justify-between items-center">
                                    <span>例: ${t.example}</span>
                                    <svg class="w-3 h-3 text-brand-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `,
            menu: () => { // TechMenu
                const t = TECHNIQUES.find(x => x.id === state.techId);
                return `
                <div class="p-5 h-full flex flex-col">
                    <button onclick="app.goHome()" class="text-xs text-slate-400 hover:text-slate-600 mb-4 flex items-center gap-1"><span class="text-lg">←</span> 一覧に戻る</button>
                    <div class="bg-white rounded-2xl p-6 text-center shadow-soft border border-slate-50 mb-6">
                        <h2 class="text-xl font-bold text-slate-800 mb-1">${t.title}</h2>
                        <p class="text-xs text-slate-500 mb-4">${t.desc}</p>
                        <div class="inline-block px-3 py-1 bg-slate-100 rounded text-xs font-mono text-slate-600">例: ${t.example}</div>
                    </div>
                    <div class="grid gap-3">
                        <button onclick="app.openStudy()" class="bg-brand-50 rounded-xl p-4 flex items-center justify-between border border-brand-100 active:bg-brand-100">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-brand-500 text-white flex items-center justify-center font-bold text-sm">1</div>
                                <div class="text-left">
                                    <div class="font-bold text-brand-800 text-sm">解説モード</div>
                                    <div class="text-[10px] text-brand-600">仕組みをステップごとに理解</div>
                                </div>
                            </div>
                            <span class="text-brand-400">▶</span>
                        </button>
                        <button onclick="app.startPractice()" class="bg-emerald-50 rounded-xl p-4 flex items-center justify-between border border-emerald-100 active:bg-emerald-100">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-emerald-500 text-white flex items-center justify-center font-bold text-sm">2</div>
                                <div class="text-left">
                                    <div class="font-bold text-emerald-800 text-sm">練習モード</div>
                                    <div class="text-[10px] text-emerald-600">問題を解いて定着させる</div>
                                </div>
                            </div>
                            <span class="text-emerald-400">▶</span>
                        </button>
                    </div>
                </div>`;
            },
            study: () => {
                const tech = TECHNIQUES.find(t => t.id === state.techId);
                const steps = tech.explain(state.problem.num1, state.problem.num2);
                const s = steps[state.studyStep];
                const done = state.studyStep >= steps.length;
                return `
                <div class="flex flex-col h-full">
                    <div class="p-4 flex justify-between items-center border-b border-slate-50">
                        <button onclick="app.selectTechnique('${state.techId}')" class="text-xs text-slate-400">中断</button>
                        <span class="text-xs font-bold text-slate-300">STEP ${Math.min(state.studyStep+1, steps.length)}/${steps.length}</span>
                    </div>
                    <div class="flex-grow flex flex-col items-center justify-center p-4 text-center">
                        <div class="text-4xl font-mono font-bold text-slate-700 mb-6 tracking-wider">
                            ${state.problem.num1} × ${state.problem.num2}
                        </div>
                        ${!done ? `
                            <div class="bg-white w-full p-5 rounded-2xl shadow-soft border border-slate-50 animate-pop">
                                <div class="text-xl font-mono text-brand-600 font-bold mb-3">${s.math}</div>
                                <div class="text-sm text-slate-600 leading-relaxed">${s.text}</div>
                            </div>
                        ` : `
                            <div class="animate-pop">
                                <div class="text-emerald-500 text-4xl mb-2">✓</div>
                                <h3 class="font-bold text-slate-800">理解しました！</h3>
                            </div>
                        `}
                    </div>
                    <div class="p-4 border-t border-slate-100 bg-white grid grid-cols-2 gap-3">
                        ${state.studyStep > 0 && !done ? `<button onclick="app.prevStep()" class="col-span-1 bg-slate-100 text-slate-600 py-3 rounded-lg text-sm font-bold">戻る</button>` : ''}
                        ${!done 
                            ? `<button onclick="app.nextStep()" class="${state.studyStep>0?'col-span-1':'col-span-2'} bg-brand-500 text-white py-3 rounded-lg text-sm font-bold shadow-md">次へ</button>` 
                            : `<div class="col-span-2 grid grid-cols-2 gap-3">
                                <button onclick="app.prevStep()" class="bg-slate-100 text-slate-600 py-3 rounded-lg text-sm font-bold">戻る</button>
                                <button onclick="app.startPractice()" class="bg-emerald-500 text-white py-3 rounded-lg text-sm font-bold shadow-md">練習へ</button>
                               </div>`}
                    </div>
                </div>`;
            },
            practice: () => {
                const tech = TECHNIQUES.find(t => t.id === state.techId);
                return `
                <div class="flex flex-col h-full">
                    <div class="p-3 flex justify-between items-center bg-white border-b border-slate-50">
                        <button onclick="app.selectTechnique('${state.techId}')" class="text-xs font-bold text-slate-400 bg-slate-100 px-3 py-1.5 rounded-lg flex items-center gap-1">← メニュー</button>
                        <span class="text-xs font-bold text-brand-200">PRACTICE</span>
                    </div>
                    <div class="flex-grow flex flex-col items-center justify-center p-4 relative">
                        <div id="feedback" class="hidden absolute inset-0 z-10 flex items-center justify-center bg-white/80"></div>
                        <div class="text-xs text-brand-400 mb-2">${tech.subtitle}</div>
                        <div class="text-5xl font-mono font-bold text-slate-700 mb-6 tracking-wider">
                            ${state.problem.num1} × ${state.problem.num2}
                        </div>
                        <div id="input-box" class="w-40 h-14 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-inner">
                             <div id="input-display" class="text-3xl font-mono font-bold text-slate-800 blink-caret h-8"></div>
                        </div>
                    </div>
                    ${NumPad('app.checkPractice()')}
                </div>`;
            },
            challenge: () => `
                <div class="flex flex-col h-full">
                    <div class="p-4 flex justify-between items-end border-b border-slate-50">
                        <div class="w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-slate-700 transition-all duration-300" style="width: ${(state.questionCount/10)*100}%"></div>
                        </div>
                        <span class="text-xs font-bold text-slate-400">Q.${state.questionCount}</span>
                    </div>
                    <div class="flex-grow flex flex-col items-center justify-center p-4 relative">
                        <div id="feedback" class="hidden absolute inset-0 z-10 flex items-center justify-center bg-white/80"></div>
                        <div class="text-[10px] text-slate-300 uppercase tracking-widest mb-2">${state.problem.technique.title}</div>
                        <div class="text-5xl font-mono font-bold text-slate-700 mb-8 tracking-wider">
                            ${state.problem.num1} × ${state.problem.num2}
                        </div>
                        <div class="w-40 h-14 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-inner">
                             <div id="input-display" class="text-3xl font-mono font-bold text-slate-800 blink-caret h-8"></div>
                        </div>
                    </div>
                    ${NumPad('app.submitChallenge()')}
                </div>`,
            result: () => `
                <div class="h-full p-6 flex flex-col justify-center text-center">
                    <div class="bg-white rounded-3xl p-8 shadow-soft border border-slate-50 mb-6">
                        <div class="text-xs text-slate-400 uppercase tracking-widest mb-2">RESULT</div>
                        <div class="text-6xl font-black text-slate-700 mb-1">${state.score}<span class="text-2xl text-slate-300 font-medium">/10</span></div>
                        <div class="text-lg font-bold text-brand-500 mb-6">${state.score===10?'完璧です！':state.score>=8?'素晴らしい！':'練習あるのみ！'}</div>
                        <div class="h-32 overflow-y-auto bg-slate-50 rounded-lg p-2 text-left mb-4 text-xs">
                            ${state.history.map((h,i)=>`<div class="flex justify-between py-1 border-b border-slate-100"><span class="text-slate-500">Q${i+1} ${h.num1}×${h.num2}</span><span class="${h.correct?'text-emerald-500':'text-red-400'} font-mono">${h.correct?'○':h.ans}</span></div>`).join('')}
                        </div>
                        <div class="grid gap-3">
                            <button onclick="app.startChallenge()" class="bg-slate-700 text-white py-3 rounded-xl font-bold text-sm shadow-lg">再挑戦</button>
                            <button onclick="app.goHome()" class="bg-white border border-slate-200 text-slate-600 py-3 rounded-xl font-bold text-sm">ホーム</button>
                        </div>
                    </div>
                </div>`
        };

        // Key support
        window.addEventListener('keydown', (e) => {
            if(/^[0-9]$/.test(e.key)) app.handleInput(e.key);
            else if(e.key==='Backspace') app.handleInput('BS');
            else if(e.key==='Enter') {
                if(state.mode==='practice') app.checkPractice();
                if(state.mode==='challenge') app.submitChallenge();
            }
        });
        document.addEventListener('click', () => Sound.init(), { once: true });
        
        // Init
        app.render();
    </script>
</body>
</html>
