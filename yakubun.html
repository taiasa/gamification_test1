<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´„åˆ†ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼</title>
    <!-- Tailwind CSSã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .fraction-display {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            font-size: 4rem;
            font-weight: 700;
            margin: 2rem 0;
            min-height: 100px;
        }
        .fraction-line {
            width: 100%;
            height: 4px;
            background-color: #3b82f6; /* Blue 500 */
            margin: 0.5rem 0;
        }
        .numerator, .denominator {
            padding: 0 1rem;
            transition: color 0.3s;
        }
        .is-reduced {
            color: #10b981; /* Green 500 */
        }
        /* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« (Tailwindã§ä¸è¶³ã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’è£œå®Œ) */
        .form-radio {
            appearance: none;
            display: inline-block;
            vertical-align: middle;
            background-origin: border-box;
            user-select: none;
            flex-shrink: 0;
            border-radius: 100%;
            border-width: 2px;
            border-color: #d1d5db; /* gray-300 */
            transition: all 0.15s ease-in-out;
        }
        .form-radio:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
            border-color: #2563eb; /* blue-600 */
            background-color: #2563eb; /* blue-600 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-8 transition-all duration-300">
        <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">ğŸš€ ç´„åˆ†ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼</h1>
        
        <!-- ã‚²ãƒ¼ãƒ æƒ…å ±ãƒ‘ãƒãƒ« -->
        <div class="flex justify-between items-center mb-6 text-lg font-medium">
            <div id="score-display" class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-lg shadow-inner">ã‚¹ã‚³ã‚¢: 0</div>
            <div id="timer-display" class="bg-red-100 text-red-800 px-4 py-2 rounded-lg shadow-inner">æ®‹ã‚Šæ™‚é–“: 30</div>
        </div>

        <!-- é›£æ˜“åº¦é¸æŠ (ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã¯å¸¸ã«æœ‰åŠ¹) -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2 text-center">é›£æ˜“åº¦é¸æŠ:</label>
            <div id="difficulty-options" class="flex flex-wrap justify-center gap-4 p-3 bg-gray-100 rounded-lg shadow-inner">
                <label class="inline-flex items-center p-2 rounded-lg bg-white hover:bg-blue-50 transition duration-150 cursor-pointer shadow-sm">
                    <input type="radio" name="difficulty" value="beginner" class="form-radio text-blue-600 h-5 w-5" checked>
                    <span class="ml-2 text-gray-700">åˆç´š (1æ¡)</span>
                </label>
                <label class="inline-flex items-center p-2 rounded-lg bg-white hover:bg-blue-50 transition duration-150 cursor-pointer shadow-sm">
                    <input type="radio" name="difficulty" value="intermediate" class="form-radio text-blue-600 h-5 w-5">
                    <span class="ml-2 text-gray-700">ä¸­ç´š (1æ¡/2æ¡)</span>
                </label>
                <label class="inline-flex items-center p-2 rounded-lg bg-white hover:bg-blue-50 transition duration-150 cursor-pointer shadow-sm">
                    <input type="radio" name="difficulty" value="advanced" class="form-radio text-blue-600 h-5 w-5">
                    <span class="ml-2 text-gray-700">ä¸Šç´š (2æ¡)</span>
                </label>
            </div>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
        <div id="message-area" class="h-10 text-center text-xl font-semibold mb-4 text-gray-700">æº–å‚™OKï¼</div>

        <!-- åˆ†æ•°è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="fraction-area" class="flex justify-center items-center">
            <div class="fraction-display border-2 border-blue-300 rounded-lg p-4 shadow-lg bg-blue-50">
                <span id="numerator-display" class="numerator">0</span>
                <div class="fraction-line"></div>
                <span id="denominator-display" class="denominator">0</span>
            </div>
        </div>
        
        <!-- å…¥åŠ›ã¨æ“ä½œã‚¨ãƒªã‚¢ -->
        <div id="input-area" class="mt-8 flex flex-col space-y-4">
            <label for="divisor-input" class="text-lg font-medium text-gray-600">å…¬ç´„æ•°ï¼ˆå‰²ã‚Šåˆ‡ã‚Œã‚‹æ•°ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</label>
            <input type="number" id="divisor-input" placeholder="ä¾‹: 2 ã¾ãŸã¯ 4" 
                   class="w-full p-3 border-2 border-blue-400 rounded-lg focus:ring-4 focus:ring-blue-300 transition duration-150 text-xl text-center"
                   min="2" disabled>
            
            <button id="submit-button" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition duration-300 ease-in-out disabled:opacity-50"
                    disabled>
                ç´„åˆ†å®Ÿè¡Œï¼
            </button>
            
            <!-- ãƒªã‚¿ã‚¤ã‚¢ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
            <button id="retire-button" 
                    class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-300 ease-in-out hidden disabled:opacity-50">
                ãƒªã‚¿ã‚¤ã‚¢ï¼ˆã‚²ãƒ¼ãƒ çµ‚äº†ï¼‰
            </button>

            <button id="start-button" 
                    class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-300 ease-in-out">
                ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
            </button>
        </div>

        <!-- ãƒªã‚¶ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« (éè¡¨ç¤º) -->
        <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-sm">
                <h2 id="modal-title" class="text-3xl font-bold text-blue-600 mb-4">ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
                <p id="final-score" class="text-2xl font-semibold mb-6">æœ€çµ‚ã‚¹ã‚³ã‚¢: 0</p>
                <!-- ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€Œã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã€ã‹ã‚‰ã€Œæº–å‚™OKã€ã®ã‚ˆã†ã«å¤‰ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã ãŒã€ä¸€æ—¦ã¯å‡¦ç†ã®ã¿å¤‰æ›´ -->
                <button id="restart-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md">
                    ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentNumerator = 0;
        let currentDenominator = 0;
        let score = 0;
        let timeLeft = 30; // ã‚²ãƒ¼ãƒ æ™‚é–“ (ç§’)
        let gameInterval = null;
        let gameRunning = false;
        let difficultyLevel = 'beginner'; // åˆæœŸé›£æ˜“åº¦ã‚’ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®åˆæœŸé¸æŠã«åˆã‚ã›ã‚‹
        
        // DOMè¦ç´ ã®å–å¾—
        const numDisplay = document.getElementById('numerator-display');
        const denDisplay = document.getElementById('denominator-display');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');
        const messageArea = document.getElementById('message-area');
        const divisorInput = document.getElementById('divisor-input');
        const submitButton = document.getElementById('submit-button');
        const startButton = document.getElementById('start-button');
        const retireButton = document.getElementById('retire-button'); // ãƒªã‚¿ã‚¤ã‚¢ãƒœã‚¿ãƒ³ã‚’å–å¾—
        const difficultyOptions = document.getElementById('difficulty-options'); // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’å–å¾—
        const resultModal = document.getElementById('result-modal');
        const modalTitle = document.getElementById('modal-title');
        const finalScore = document.getElementById('final-score');
        const restartButton = document.getElementById('restart-button');

        /**
         * æœ€å¤§å…¬ç´„æ•° (GCD) ã‚’ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã§è¨ˆç®—ã™ã‚‹
         * @param {number} a 
         * @param {number} b 
         * @returns {number} æœ€å¤§å…¬ç´„æ•°
         */
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        /**
         * æ–°ã—ã„åˆ†æ•°ã‚’ç”Ÿæˆã™ã‚‹ (å¿…ãšå…¬ç´„æ•° G > 1 ã‚’æŒã¤ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£)
         */
        function generateNewFraction() {
            let nPrime, dPrime; // å…ƒã¨ãªã‚‹åˆ†æ•°ï¼ˆä¹—ç®—ã•ã‚Œã‚‹å‰ï¼‰
            let commonDivisorG; // å¿…ãšå­˜åœ¨ã™ã‚‹å…¬ç´„æ•° G
            let nMaxLimit, dMaxLimit; // æœ€çµ‚çš„ãªåˆ†å­ãƒ»åˆ†æ¯ã®æœ€å¤§å€¤

            // é›£æ˜“åº¦è¨­å®šã«å¿œã˜ãŸæœ€çµ‚çš„ãªä¸Šé™ã‚’æ±ºå®š
            switch (difficultyLevel) {
                case 'beginner':
                    nMaxLimit = 9;
                    dMaxLimit = 9;
                    commonDivisorG = Math.floor(Math.random() * (5 - 2 + 1)) + 2; // G: 2-5ã®ç¯„å›²ã§å…¬ç´„æ•°ã‚’æ±ºå®š
                    break;
                case 'intermediate':
                    nMaxLimit = 9; // åˆ†å­1æ¡
                    dMaxLimit = 99; // åˆ†æ¯2æ¡
                    commonDivisorG = Math.floor(Math.random() * (9 - 2 + 1)) + 2; // G: 2-9ã®ç¯„å›²ã§å…¬ç´„æ•°ã‚’æ±ºå®š
                    break;
                case 'advanced':
                    nMaxLimit = 99;
                    dMaxLimit = 99;
                    commonDivisorG = Math.floor(Math.random() * (12 - 2 + 1)) + 2; // G: 2-12ã®ç¯„å›²ã§å…¬ç´„æ•°ã‚’æ±ºå®š
                    break;
                default:
                    nMaxLimit = 9;
                    dMaxLimit = 9;
                    commonDivisorG = 2;
                    break;
            }

            // Gã§å‰²ã£ãŸå¾Œã®ã€åˆ†å­(n')ã¨åˆ†æ¯(d')ã®æœ€å¤§å€¤
            const nPrimeMax = Math.floor(nMaxLimit / commonDivisorG);
            const dPrimeMax = Math.floor(dMaxLimit / commonDivisorG);

            // æœ€å°å€¤ã¯å¸¸ã«1ï¼ˆGã‚’ä¹—ç®—ã—ã¦ã‚‚2ä»¥ä¸Šã®å…¬ç´„æ•°GãŒæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ï¼‰
            const nPrimeMin = 1;
            const dPrimeMin = 1;

            // N < D ã‹ã¤ N' ã¨ D' ãŒç¯„å›²å†…ã«åã¾ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
            do {
                // n' ã¨ d' ã‚’ç¯„å›²å†…ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆ
                nPrime = Math.floor(Math.random() * (nPrimeMax - nPrimeMin + 1)) + nPrimeMin;
                dPrime = Math.floor(Math.random() * (dPrimeMax - dPrimeMin + 1)) + dPrimeMin;

                // N' < D' ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹
                if (nPrime >= dPrime) {
                    continue; // N' >= D' ã®å ´åˆã¯å†ç”Ÿæˆ
                }
                
            // ãƒ«ãƒ¼ãƒ—ã‚’ç¶šã‘ã‚‹æ¡ä»¶ï¼šN'ã¨D'ãŒæœ‰åŠ¹ãªç¯„å›²å†…ã§ã€N' < D' ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹
            } while (nPrime < nPrimeMin || dPrime < dPrimeMin || nPrime >= dPrime);

            // æœ€çµ‚çš„ãªåˆ†æ•° (n = n' * G, d = d' * G)
            currentNumerator = nPrime * commonDivisorG;
            currentDenominator = dPrime * commonDivisorG;

            updateFractionDisplay();
            messageArea.textContent = `ã•ã‚ç´„åˆ†ã ï¼å…¬ç´„æ•°ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼`;
        }
        
        /**
         * åˆ†æ•°è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         */
        function updateFractionDisplay() {
            numDisplay.textContent = currentNumerator;
            denDisplay.textContent = currentDenominator;
            
            // æ—¢ç´„åˆ†æ•°ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯
            const isReduced = gcd(currentNumerator, currentDenominator) === 1;
            
            if (isReduced) {
                numDisplay.classList.add('is-reduced');
                denDisplay.classList.add('is-reduced');
            } else {
                numDisplay.classList.remove('is-reduced');
                denDisplay.classList.remove('is-reduced');
            }
        }

        /**
         * ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°ã—ã€è¡¨ç¤ºã‚’åæ˜ ã™ã‚‹
         * @param {number} points åŠ ç®—ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ
         */
        function updateScore(points) {
            score += points;
            scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
        }

        /**
         * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ï¼ˆå…¬ç´„æ•°ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ç´„åˆ†ã‚’å®Ÿè¡Œã™ã‚‹
         */
        function checkAndReduce() {
            if (!gameRunning) return;

            const divisor = parseInt(divisorInput.value, 10);
            divisorInput.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            divisorInput.focus(); // å†åº¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹

            if (isNaN(divisor) || divisor < 2) {
                messageArea.textContent = "2ä»¥ä¸Šã®æœ‰åŠ¹ãªæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            // å‰²ã‚Šåˆ‡ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (currentNumerator % divisor === 0 && currentDenominator % divisor === 0) {
                
                // ç´„åˆ†å‰ã®åˆ†æ•°ã§GCDã‚’è¨ˆç®—ã™ã‚‹ï¼ˆãƒœãƒ¼ãƒŠã‚¹åˆ¤å®šã®ãŸã‚ï¼‰
                const originalGcd = gcd(currentNumerator, currentDenominator);

                // ç´„åˆ†å®Ÿè¡Œ
                currentNumerator /= divisor;
                currentDenominator /= divisor;
                updateFractionDisplay();

                
                let points = divisor * 10; // å…¬ç´„æ•°ãŒå¤§ãã„ã»ã©é«˜å¾—ç‚¹

                // divisorãŒå…ƒã®åˆ†æ•°ã®æœ€å¤§å…¬ç´„æ•°ã ã£ãŸå ´åˆ
                if (divisor === originalGcd) {
                    points += 50; // æœ€å¤§å…¬ç´„æ•°ãƒœãƒ¼ãƒŠã‚¹
                    messageArea.textContent = `ã™ã”ã„ï¼æœ€å¤§å…¬ç´„æ•°(${divisor})ã§ä¸€ç™ºç´„åˆ†ï¼ (+${points}pt)`;
                } else {
                    messageArea.textContent = `ç´„åˆ†æˆåŠŸï¼æ¬¡ã¯ã‚‚ã£ã¨å¤§ããªæ•°ã§å‰²ã‚Œã‚‹ã‹ãªï¼Ÿ (+${points}pt)`;
                }
                
                updateScore(points);

                // æ—¢ç´„åˆ†æ•°ã«ãªã£ãŸã‹ãƒã‚§ãƒƒã‚¯
                if (gcd(currentNumerator, currentDenominator) === 1) {
                    messageArea.textContent = "æ—¢ç´„åˆ†æ•°ã«ãªã‚Šã¾ã—ãŸï¼æ¬¡ã®å•é¡Œã¸ï¼";
                    updateScore(100); // å•é¡Œã‚¯ãƒªã‚¢ãƒœãƒ¼ãƒŠã‚¹
                    setTimeout(generateNewFraction, 1500); // 1.5ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸
                }

            } else {
                messageArea.textContent = `${divisor}ã§ã¯å‰²ã‚Œã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã‚ˆã†ã€‚`;
                // é–“é•ãˆãŸå ´åˆã®ãƒšãƒŠãƒ«ãƒ†ã‚£
                updateScore(-10);
            }
        }
        
        /**
         * ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã€ã‚¿ã‚¤ãƒãƒ¼ã¨å•é¡Œç”Ÿæˆã‚’é–‹å§‹ã™ã‚‹
         */
        function startGame() {
            if (gameRunning) return;
            
            score = 0;
            timeLeft = 30; // 30ç§’ã«ãƒªã‚»ãƒƒãƒˆ
            gameRunning = true;
            
            // UIã®åˆæœŸåŒ–
            scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
            timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}`;
            resultModal.classList.add('hidden');
            resultModal.classList.remove('flex');
            startButton.classList.add('hidden');
            retireButton.classList.remove('hidden'); // ãƒªã‚¿ã‚¤ã‚¢ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            submitButton.disabled = false;
            divisorInput.disabled = false;
            
            divisorInput.value = '';
            divisorInput.focus();

            // æœ€åˆã®å•é¡Œç”Ÿæˆ
            generateNewFraction();

            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
            gameInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}`;

                if (timeLeft <= 10) {
                    timerDisplay.classList.add('bg-red-500', 'text-white');
                    timerDisplay.classList.remove('bg-red-100', 'text-red-800');
                }

                if (timeLeft <= 0) {
                    endGame(false); // æ™‚é–“åˆ‡ã‚Œã§çµ‚äº†
                }
            }, 1000);
        }
        
        /**
         * ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã®å¾…æ©ŸçŠ¶æ…‹ã«æˆ»ã™ï¼ˆã€Œã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã€ç”¨ï¼‰
         */
        function resetGame() {
            // é€²è¡Œä¸­ã®ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°åœæ­¢
            clearInterval(gameInterval);
            gameRunning = false;
            
            // çŠ¶æ…‹ã‚’åˆæœŸåŒ–
            currentNumerator = 0;
            currentDenominator = 0;
            score = 0;
            timeLeft = 30;

            // UIã‚’ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã®çŠ¶æ…‹ã«æˆ»ã™
            updateScore(0); // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’0ã«ãƒªã‚»ãƒƒãƒˆ
            timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}`;
            timerDisplay.classList.remove('bg-red-500', 'text-white');
            timerDisplay.classList.add('bg-red-100', 'text-red-800');

            numDisplay.textContent = 0;
            denDisplay.textContent = 0;
            numDisplay.classList.remove('is-reduced');
            denDisplay.classList.remove('is-reduced');

            messageArea.textContent = "æº–å‚™OKï¼ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ï¼"; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª¿æ•´
            divisorInput.value = '';

            submitButton.disabled = true;
            divisorInput.disabled = true;

            // ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ: ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã€ãƒªã‚¿ã‚¤ã‚¢ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            startButton.classList.remove('hidden'); 
            retireButton.classList.add('hidden');    
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éè¡¨ç¤º
            resultModal.classList.add('hidden');
            resultModal.classList.remove('flex');
        }

        /**
         * ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã™ã‚‹
         * @param {boolean} isRetire ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¿ã‚¤ã‚¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸå ´åˆã¯ true
         */
        function endGame(isRetire = false) {
            clearInterval(gameInterval);
            gameRunning = false;
            
            // UIã®æ›´æ–°
            submitButton.disabled = true;
            divisorInput.disabled = true;
            
            // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            timerDisplay.classList.remove('bg-red-500', 'text-white');
            timerDisplay.classList.add('bg-red-100', 'text-red-800');
            
            // ãƒªã‚¶ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            if (isRetire) {
                modalTitle.textContent = "ãƒªã‚¿ã‚¤ã‚¢ã—ã¾ã—ãŸ";
            } else {
                modalTitle.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼"; // æ™‚é–“åˆ‡ã‚Œã®å ´åˆ
            }
            
            finalScore.textContent = `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}ç‚¹`;
            resultModal.classList.remove('hidden');
            resultModal.classList.add('flex');
        }

        /**
         * é›£æ˜“åº¦é¸æŠãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã®å‡¦ç†ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³å¯¾å¿œï¼‰
         */
        function handleDifficultyChange(event) {
            const selectedRadio = event.target.closest('input[name="difficulty"]');
            if (selectedRadio) {
                difficultyLevel = selectedRadio.value;
                // é¸æŠã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
                const selectedText = selectedRadio.nextElementSibling.textContent;
                
                // ã‚²ãƒ¼ãƒ å®Ÿè¡Œä¸­ã§ã‚‚ã€é›£æ˜“åº¦ã‚’å¤‰æ›´ã—ãŸã“ã¨ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ä¼ãˆã‚‹
                if (gameRunning) {
                    messageArea.textContent = `é›£æ˜“åº¦ãŒã€Œ${selectedText}ã€ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚æ¬¡ã®å•é¡Œã‹ã‚‰é©ç”¨ã•ã‚Œã¾ã™ã€‚`;
                } else {
                    messageArea.textContent = `é›£æ˜“åº¦ãŒã€Œ${selectedText}ã€ã«è¨­å®šã•ã‚Œã¾ã—ãŸã€‚`;
                }
            }
        }


        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        startButton.addEventListener('click', startGame);
        // â˜…ä¿®æ­£ç‚¹: ã€Œã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã€ãƒœã‚¿ãƒ³ã§ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆçŠ¶æ…‹ã«æˆ»ã™
        restartButton.addEventListener('click', resetGame); 
        submitButton.addEventListener('click', checkAndReduce);
        difficultyOptions.addEventListener('change', handleDifficultyChange); // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        
        // ãƒªã‚¿ã‚¤ã‚¢æ©Ÿèƒ½ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        retireButton.addEventListener('click', () => {
            if (gameRunning) {
                endGame(true); // ãƒªã‚¿ã‚¤ã‚¢ã§çµ‚äº†
            }
        });

        divisorInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAndReduce();
            }
        });

        // åˆæœŸè¡¨ç¤º
        resetGame(); // ã‚¢ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒªã‚»ãƒƒãƒˆé–¢æ•°ã‚’å‘¼ã³ã€åˆæœŸå¾…æ©ŸçŠ¶æ…‹ã«ã™ã‚‹

        // åˆæœŸã®é¸æŠçŠ¶æ…‹ã«åˆã‚ã›ã¦é›£æ˜“åº¦ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š
        const initialSelected = document.querySelector('input[name="difficulty"]:checked');
        if (initialSelected) {
            difficultyLevel = initialSelected.value;
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ resetGame ã§è¨­å®šæ¸ˆã¿ã®ãŸã‚ã€ã“ã“ã§ã¯ã‚¹ã‚­ãƒƒãƒ—
        }
    </script>
</body>
</html>