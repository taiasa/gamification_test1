<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå¿œé€Ÿåº¦ãƒ†ã‚¹ãƒˆ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã¨ä¸­å¤®é…ç½®ã®ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        #game-area {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        #game-area:active {
            transform: scale(0.98); /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        }
        /* åˆæœŸçŠ¶æ…‹ã®èµ¤è‰² */
        .status-start {
            background-color: #ef4444; /* red-500 */
        }
        /* å¾…ã¡çŠ¶æ…‹ã®ç°è‰² */
        .status-wait {
            background-color: #9ca3af; /* gray-400 */
        }
        /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªç·‘è‰² */
        .status-go {
            background-color: #10b981; /* emerald-500 */
        }
        /* çµæœè¡¨ç¤ºç”¨ã®é’è‰² */
        .status-result {
            background-color: #3b82f6; /* blue-500 */
        }
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>

<div class="w-full max-w-lg mx-auto bg-white p-6 rounded-2xl shadow-2xl">
    <h1 class="text-4xl font-bold text-center mb-6 text-gray-800">åå¿œé€Ÿåº¦ãƒ†ã‚¹ãƒˆ</h1>

    <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
    <div id="game-area" 
         class="status-start w-full aspect-square flex flex-col justify-center items-center rounded-xl p-8 text-white text-center shadow-lg hover:shadow-xl transition-all duration-300">
        <p id="message" class="text-3xl sm:text-4xl font-extrabold mb-2 text-shadow">ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹</p>
        <p id="time-display" class="text-xl sm:text-2xl font-semibold opacity-80 text-shadow"></p>
    </div>

    <!-- èª¬æ˜ã¨ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
    <div class="mt-6 p-4 bg-gray-100 rounded-lg shadow-inner">
        <p class="text-sm text-gray-600 mb-2">ãƒ«ãƒ¼ãƒ«: ç”»é¢ãŒèµ¤ã‹ã‚‰ç·‘ã«å¤‰ã‚ã£ãŸã‚‰ã€ã™ãã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
        <p id="high-score" class="text-lg font-bold text-gray-700">ãƒã‚¤ã‚¹ã‚³ã‚¢: -</p>
    </div>
</div>

<script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let gameStatus = 'start'; // 'start', 'waiting', 'go', 'result'
    let timerId = null; // setTimeoutã®ID
    let startTime = null; // ç·‘ã«å¤‰ã‚ã£ãŸæ™‚åˆ» (Go!)
    let highScore = localStorage.getItem('reactionHighScore') || Infinity; // ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’localStorageã‹ã‚‰å–å¾—

    // DOMè¦ç´ 
    const gameArea = document.getElementById('game-area');
    const messageDisplay = document.getElementById('message');
    const timeDisplay = document.getElementById('time-display');
    const highScoreDisplay = document.getElementById('high-score');

    /**
     * ãƒã‚¤ã‚¹ã‚³ã‚¢ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
     */
    function updateHighScoreDisplay() {
        if (highScore === Infinity || isNaN(highScore)) {
            highScoreDisplay.textContent = 'ãƒã‚¤ã‚¹ã‚³ã‚¢: -';
        } else {
            highScoreDisplay.textContent = `ãƒã‚¤ã‚¹ã‚³ã‚¢: ${highScore} ãƒŸãƒªç§’`;
        }
    }

    /**
     * ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°ã—ã€ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ä¿å­˜ã—ã¾ã™ã€‚
     * @param {number} newTime - é”æˆã—ãŸåå¿œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
     */
    function saveScore(newTime) {
        if (newTime < highScore) {
            highScore = newTime;
            localStorage.setItem('reactionHighScore', highScore);
            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ã®è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            messageDisplay.textContent = 'æ–°è¨˜éŒ²é”æˆï¼ğŸ‰';
        }
        updateHighScoreDisplay();
    }

    /**
     * ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ã€‚
     * @param {string} newStatus - 'start', 'waiting', 'go', 'result' ã®ã„ãšã‚Œã‹
     * @param {string} message - ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
     * @param {string} timeText - ã‚µãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ™‚é–“è¡¨ç¤ºãªã©ï¼‰
     */
    function updateUI(newStatus, message, timeText = '') {
        gameStatus = newStatus;
        gameArea.className = 'w-full aspect-square flex flex-col justify-center items-center rounded-xl p-8 text-white text-center shadow-lg hover:shadow-xl transition-all duration-300';
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«åŸºã¥ã„ã¦ã‚¯ãƒ©ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        if (newStatus === 'start') {
            gameArea.classList.add('status-start');
        } else if (newStatus === 'waiting') {
            gameArea.classList.add('status-wait');
        } else if (newStatus === 'go') {
            gameArea.classList.add('status-go');
        } else if (newStatus === 'result') {
            gameArea.classList.add('status-result');
        }

        messageDisplay.textContent = message;
        timeDisplay.textContent = timeText;
    }

    /**
     * ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹çŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚
     */
    function startState() {
        // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
        if (timerId !== null) {
            clearTimeout(timerId);
            timerId = null;
        }
        startTime = null;
        updateUI('start', 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹', '');
    }

    /**
     * å¾…ã¡çŠ¶æ…‹ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ï¼‰ã«å…¥ã‚Šã¾ã™ã€‚
     */
    function waitingState() {
        updateUI('waiting', 'å¾…ã£ã¦...');
        
        // 1ç§’ã‹ã‚‰4ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ã‚’è¨­å®š (1000ms ~ 4000ms)
        const delay = Math.random() * 3000 + 1000; 

        timerId = setTimeout(goState, delay);
    }

    /**
     * ã‚¯ãƒªãƒƒã‚¯å¯èƒ½çŠ¶æ…‹ï¼ˆGo!ï¼‰ã«å…¥ã‚Šã¾ã™ã€‚
     */
    function goState() {
        updateUI('go', 'ã‚¯ãƒªãƒƒã‚¯ï¼');
        startTime = performance.now(); // ç·‘ã«å¤‰ã‚ã£ãŸæ­£ç¢ºãªæ™‚åˆ»ã‚’è¨˜éŒ²
    }

    /**
     * æ—©ã™ããŸå ´åˆã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
     */
    function falseStartState() {
        // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
        if (timerId !== null) {
            clearTimeout(timerId);
            timerId = null;
        }
        startTime = null;
        updateUI('start', 'æ—©ã™ãã¾ã™ï¼', 'ã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†æŒ‘æˆ¦');
    }

    /**
     * ãƒ¡ã‚¤ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
     */
    gameArea.addEventListener('click', () => {
        const now = performance.now();

        if (gameStatus === 'start' || gameStatus === 'result') {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œé–‹å§‹ã€ã¾ãŸã¯ã€Œçµæœè¡¨ç¤ºã€ã®å ´åˆã€å¾…ã¡çŠ¶æ…‹ã«ç§»è¡Œ
            waitingState();
        } 
        else if (gameStatus === 'waiting') {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œå¾…ã¡ã€ã®é–“ã«ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆï¼ˆãƒ•ãƒ©ã‚¤ãƒ³ã‚°ï¼‰
            falseStartState();
        } 
        else if (gameStatus === 'go') {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€ŒGo!ã€ã®å ´åˆã€åå¿œæ™‚é–“ã‚’è¨ˆç®—ã—ã¦çµæœè¡¨ç¤º
            if (startTime !== null) {
                const reactionTime = Math.round(now - startTime);
                updateUI('result', `${reactionTime} ãƒŸãƒªç§’`, 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†æŒ‘æˆ¦');
                saveScore(reactionTime);
            }
            startState(); // çµæœã‚’è¡¨ç¤ºã—ãŸå¾Œã€æ¬¡ã®ã‚¯ãƒªãƒƒã‚¯ã§å†é–‹ã§ãã‚‹ã‚ˆã†ã«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
        }
    });

    // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚
    window.onload = () => {
        startState();
        updateHighScoreDisplay();
    };

</script>

</body>
</html>