<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„ÇØ„É≠„Éé„Éª„Çπ„ÇØ„É≠„Éº„É´ÔºöÊôÇÁ©∫„ÅÆÁ∑®Á∫ÇËÄÖ</title>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700;800&family=Zen+Maru+Gothic:wght@700&family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f13;
            --accent-gold: #eebb44;
            --accent-red: #ff4757;
            --accent-blue: #2ed573;
            --card-bg: #fdf5e6;
            --card-border: #4a3b32;
            --text-main: #f1f2f6;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Shippori Mincho', serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at center, #1e1e24 0%, #000 100%);
        }

        /* --- Header --- */
        header {
            padding: 10px 20px;
            background: rgba(0,0,0,0.85);
            border-bottom: 2px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            height: 60px;
            flex-shrink: 0;
        }
        .logo {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--accent-gold);
            letter-spacing: 1px;
            white-space: nowrap;
        }
        .home-btn {
            background: none;
            border: 1px solid #555;
            color: #aaa;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .home-btn:hover { background: #333; color: #fff; }

        /* --- Main Area --- */
        #game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* --- Hand (Cards) --- */
        .hand-wrapper {
            height: 360px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            perspective: 1000px;
            margin-bottom: 10px;
            padding-bottom: 20px;
        }

        .card {
            width: 130px;
            height: 200px;
            background: var(--card-bg);
            border-radius: 10px;
            border: 4px solid var(--card-border); 
            position: relative;
            margin: 0 -10px;
            cursor: pointer;
            transition: transform 0.3s ease, border-color 0.3s, filter 0.3s;
            display: flex;
            flex-direction: column;
            color: #333;
            box-shadow: -5px 5px 15px rgba(0,0,0,0.5);
            transform-origin: center bottom;
            background-image: linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .card:hover { z-index: 50; transform: translateY(-30px) scale(1.1) !important; }

        .card.selected {
            transform: translateY(-50px) !important;
            border-color: var(--accent-red);
            box-shadow: 0 0 20px var(--accent-red);
            z-index: 60;
        }
        .card.selected::after {
            content: "‰∫§Êèõ";
            position: absolute;
            top: -24px; left: 50%;
            transform: translateX(-50%);
            background: var(--accent-red);
            color: white;
            padding: 2px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            font-weight: bold;
            white-space: nowrap;
        }

        .card.matched {
            z-index: 100;
            transform: translateY(-70px) scale(1.15) !important;
            animation: pulseGold 2s infinite;
        }
        .card.dimmed {
            filter: brightness(0.3) grayscale(0.8);
            transform: scale(0.9) translateY(20px) !important;
            z-index: 1;
        }

        .card-inner {
            padding: 8px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .c-icon { font-size: 2.2rem; margin: 5px 0; color: #5d4037; }
        .c-text { 
            font-size: 0.85rem; 
            font-weight: bold; 
            line-height: 1.3; 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            width: 100%;
            word-break: break-all;
        }
        .c-footer { font-size: 0.6rem; color: #888; border-top:1px solid #ccc; width:100%; padding-top:4px; margin-top:4px; }

        /* --- Controls --- */
        .control-panel {
            width: 95%;
            max-width: 500px;
            background: rgba(30, 30, 40, 0.95);
            border-radius: 16px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .status-text {
            color: var(--accent-gold);
            font-family: 'DotGothic16', sans-serif;
            font-size: 1rem;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(238, 187, 68, 0.5);
        }

        .btn-group { display: flex; gap: 15px; width: 100%; justify-content: center; }

        .btn {
            padding: 12px 0;
            width: 140px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            font-family: 'Zen Maru Gothic', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            font-size: 1rem;
            white-space: nowrap;
        }
        .btn-swap { background: #333; color: #ddd; border: 1px solid #555; }
        .btn-swap:hover:not(:disabled) { background: #444; color: #fff; }
        .btn-swap.active {
            background: var(--accent-blue);
            color: #000;
            box-shadow: 0 0 15px var(--accent-blue);
            animation: pulseBtn 2s infinite;
        }
        @keyframes pulseBtn {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        .btn-judge {
            background: linear-gradient(135deg, var(--accent-gold), #b8860b);
            color: #000;
            box-shadow: 0 4px 15px rgba(184, 134, 11, 0.4);
        }
        .btn-judge:hover { transform: scale(1.05); filter: brightness(1.1); }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none !important; box-shadow: none !important; animation: none;}

        .btn-sub { background: transparent; border: 2px solid #555; color: #ccc; }
        .btn-sub:hover { border-color: #888; color: #fff; background: rgba(255,255,255,0.05); }

        /* --- Overlays --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 12, 16, 0.98);
            z-index: 200;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
            padding: 20px;
        }
        .hidden { opacity: 0; pointer-events: none; }

        /* Start Screen Details */
        .start-desc {
            font-size: 0.75rem;
            color: #888;
            margin-top: 5px;
            text-align: center;
        }

        /* Result */
        .result-box {
            background: #fff;
            color: #333;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            max-width: 90%;
            width: 420px;
            max-height: 90vh;
            overflow-y: auto;
            border: 6px double #333;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
        }
        .result-box.show { transform: scale(1); opacity: 1; }
        
        .rank-stamp {
            font-size: 4rem;
            font-weight: 900;
            color: var(--accent-red);
            border: 4px solid var(--accent-red);
            display: inline-block;
            padding: 0px 20px;
            transform: rotate(-10deg);
            margin: 10px auto;
            line-height: 1.2;
        }

        /* Review List */
        .review-container {
            margin: 10px 0 20px 0;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 8px;
            text-align: left;
            font-size: 0.85rem;
            border: 1px solid #ddd;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }
        .review-list { list-style: none; padding: 0; margin: 0; }
        .review-item { padding: 4px 0; border-bottom: 1px dashed #eee; line-height: 1.4; }
        .review-item:last-child { border-bottom: none; }

        /* Animations */
        @keyframes dealCard {
            0% { transform: translateY(120%) rotate(10deg) scale(0.5); opacity: 0; }
            100% { transform: translateY(0) rotate(0) scale(1); opacity: 1; }
        }
        @keyframes discardUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-300px) rotate(-10deg) scale(0.8); opacity: 0; }
        }
        @keyframes drawIn {
            0% { transform: translateY(-80px) scale(1.1); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes heartbeat {
            0% { transform: scale(1); box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
            15% { transform: scale(1.02); box-shadow: inset 0 0 100px rgba(255, 71, 87, 0.3); }
            30% { transform: scale(1); box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
            45% { transform: scale(1.02); box-shadow: inset 0 0 100px rgba(255, 71, 87, 0.3); }
            100% { transform: scale(1); box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
        }
        @keyframes flashWin {
            0% { background-color: rgba(238, 187, 68, 0); }
            50% { background-color: rgba(238, 187, 68, 0.8); }
            100% { background-color: rgba(238, 187, 68, 0); }
        }
        @keyframes pulseGold {
            0% { box-shadow: 0 0 20px var(--accent-gold); border-color: var(--accent-gold); }
            50% { box-shadow: 0 0 60px var(--accent-gold), 0 0 10px #fff; border-color: #fff; }
            100% { box-shadow: 0 0 20px var(--accent-gold); border-color: var(--accent-gold); }
        }

        .typing-cursor::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 300;
            display: none;
        }
        .flash-anim { display: block !important; animation: flashWin 1s ease-out; }
    </style>
</head>
<body>

    <header>
        <div class="logo">CHRONO SCROLL</div>
        <button class="home-btn" onclick="app.goHome()">üè† TOP</button>
    </header>

    <!-- 1. Start Screen -->
    <div id="start-screen" class="overlay">
        <h1 style="font-size: 2.2rem; color: var(--accent-gold); text-shadow: 0 0 20px var(--accent-gold); text-align:center;">„ÇØ„É≠„Éé„Éª„Çπ„ÇØ„É≠„Éº„É´</h1>
        <p style="color:#888; letter-spacing: 2px; font-size:0.9rem;"></p>
        
        <div style="margin-top: 40px; display:flex; gap:20px; flex-direction:column; align-items:center;">
            <div style="text-align:center;">
                <button class="btn btn-judge" style="width:220px;" onclick="app.startStory()">„Ç≤„Éº„É†„Çπ„Çø„Éº„Éà</button>
                <div class="start-desc">„Ç´„Éº„Éâ„Çí‰∫§Êèõ„Åó„ÄÅÂÅâ‰∫∫„ÅÆÊ≠£„Åó„ÅÑÊÉÖÂ†±„ÇíÊèÉ„Åà„Çã<br>ÊÄùËÄÉÂûã„Éë„Ç∫„É´„Ç≤„Éº„É†</div>
            </div>
            
            <div style="text-align:center;">
                <button class="home-btn" style="color:#aaa; border:1px solid #555; width:220px; font-size:1rem;" onclick="app.showEncyclopedia()">„Ç¢„Éº„Ç´„Ç§„ÉñÔºàÂõ≥ÈëëÔºâ</button>
                <div class="start-desc">„Åì„Çå„Åæ„Åß„Å´‰øÆÂæ©„Åó„ÅüÂÅâ‰∫∫„ÅÆË®òÈå≤„ÇíÈñ≤Ë¶ß</div>
            </div>
        </div>
    </div>

    <!-- 2. Story Screen -->
    <div id="story-screen" class="overlay hidden">
        <div style="text-align:left; font-family: 'DotGothic16', sans-serif; max-width:600px; padding:20px;">
            <p id="story-text" style="line-height:2; font-size:1.1rem; color:#ddd;"></p>
        </div>
        <button id="story-next-btn" class="btn btn-judge hidden" style="margin-top:20px;" onclick="app.startGame()">„ÅÑ„Åñ„ÄÅÊ≠¥Âè≤„ÅÆ‰øÆÂæ©„Å∏</button>
    </div>

    <!-- 3. Analyzing Overlay -->
    <div id="analyzing-screen" class="overlay hidden" style="background: radial-gradient(circle, transparent 0%, #000 90%); pointer-events: none; z-index: 150;">
        <div style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; animation: heartbeat 1.2s infinite ease-in-out; background: radial-gradient(circle, rgba(200,50,50,0) 40%, rgba(200,50,50,0.1) 100%);"></div>
        <h2 style="color:var(--accent-gold); font-family:'DotGothic16'; letter-spacing:3px; text-shadow:0 0 10px red; z-index:160;">ÊôÇÁ©∫ÂêåÊúü‰∏≠...</h2>
    </div>
    
    <!-- Flash Overlay -->
    <div id="flash-overlay"></div>

    <!-- 4. Game Area -->
    <div id="game-area">
        <div class="hand-wrapper" id="hand-container">
            <!-- Cards generated here -->
        </div>

        <div class="control-panel">
            <div class="status-text" id="turn-status">ÊÆã„ÇäÂÜçÁ∑®ÂõûÊï∞: 3</div>
            
            <div class="btn-group">
                <button id="btn-swap" class="btn btn-swap" onclick="app.handleSwap()">
                    ‰∫§Êèõ„Åô„Çã
                </button>
                
                <button id="btn-judge" class="btn btn-judge" onclick="app.handleJudge()">
                    ‰øÆÂæ©Âà§ÂÆöÔºÅ
                </button>
            </div>
        </div>
    </div>

    <!-- 5. Result Screen -->
    <div id="result-screen" class="overlay hidden">
        <div class="result-box" id="result-box">
            <div id="rank-display" class="rank-stamp">S</div>
            <h3 id="result-title" style="margin:10px 0;">Ê≠¥Âè≤‰øÆÂæ©ÂÆå‰∫Ü</h3>
            <p id="result-desc" style="font-size:0.9rem; line-height:1.6; color:#555; margin-bottom:10px;"></p>
            
            <!-- Á≠î„ÅàÂêà„Çè„Åõ„Ç®„É™„Ç¢ -->
            <div id="result-review" class="review-container"></div>

            <div style="margin-top:10px; display:flex; flex-direction:column; gap:12px; align-items:center;">
                <button class="btn btn-judge" style="width:240px; font-size:1.1rem;" onclick="app.startGame(false)">Âà•„ÅÆÂÅâ‰∫∫„ÅßÈÅä„Å∂</button>
                <button class="btn btn-sub" style="width:200px; color:#555; border-color:#888;" onclick="app.startGame(true)">Âêå„Åò„É°„É≥„Éê„Éº„ÅßÂÜçÊà¶</button>
                <button class="home-btn" style="color:#888; border:none; text-decoration:underline;" onclick="app.goHome()">„Çø„Ç§„Éà„É´ÁîªÈù¢„Å∏Êàª„Çã</button>
            </div>
        </div>
    </div>

    <!-- 6. Encyclopedia Screen -->
    <div id="encyclopedia-screen" class="overlay hidden" style="background:rgba(20,20,30,0.95);">
        <h2 style="color:var(--accent-gold)">„Ç¢„Éº„Ç´„Ç§„ÉñÔºàÂõ≥ÈëëÔºâ</h2>
        <div id="encyclopedia-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; max-width:600px; width:95%; overflow-y:auto; max-height:60vh; padding:10px;"></div>
        <button class="home-btn" style="margin-top:20px; font-size:1rem; padding:10px 30px;" onclick="document.getElementById('encyclopedia-screen').classList.add('hidden')">Èñâ„Åò„Çã</button>
    </div>

    <script>
        /**
         * Sound Engine
         */
        const AudioEngine = {
            ctx: null,
            init: function() {
                if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (this.ctx.state === 'suspended') this.ctx.resume();
            },
            play: function(type) {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;
                
                const createOsc = (freq, type, dur, vol = 0.1) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, t);
                    gain.gain.setValueAtTime(vol, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + dur);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(t);
                    osc.stop(t + dur);
                };

                if (type === 'select') createOsc(800, 'sine', 0.1);
                else if (type === 'deal') {
                    const o = this.ctx.createOscillator();
                    const g = this.ctx.createGain();
                    o.frequency.setValueAtTime(400, t);
                    o.frequency.linearRampToValueAtTime(800, t + 0.1);
                    g.gain.setValueAtTime(0.05, t);
                    g.gain.linearRampToValueAtTime(0, t + 0.1);
                    o.connect(g); g.connect(this.ctx.destination);
                    o.start(t); o.stop(t+0.1);
                } else if (type === 'swap') createOsc(300, 'triangle', 0.2);
                else if (type === 'heartbeat') {
                    createOsc(60, 'sine', 0.15, 0.3);
                    setTimeout(() => createOsc(50, 'sine', 0.15, 0.2), 150);
                } else if (type === 'win') {
                    [0, 0.1, 0.2, 0.3, 0.4, 0.6].forEach((d, i) => {
                        const freq = [440, 554, 659, 880, 440, 880][i];
                        const o = this.ctx.createOscillator();
                        const g = this.ctx.createGain();
                        o.connect(g); g.connect(this.ctx.destination);
                        o.type = 'triangle';
                        o.frequency.setValueAtTime(freq, t + d);
                        g.gain.setValueAtTime(0.1, t + d);
                        g.gain.linearRampToValueAtTime(0, t + d + 0.5);
                        o.start(t+d); o.stop(t+d+0.5);
                    });
                } else if (type === 'fail') {
                    createOsc(100, 'sawtooth', 0.5, 0.2);
                    createOsc(80, 'sawtooth', 0.5, 0.2);
                } else if (type === 'type') createOsc(800, 'square', 0.03, 0.02);
            }
        };

        /**
         * Game Data
         */
        const HISTORY_DB = [
            { id: "nobunaga", name: "ÁπîÁî∞‰ø°Èï∑", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÁπîÁî∞‰ø°Èï∑", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "‚öîÔ∏è" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Êú¨ËÉΩÂØ∫„ÅÆÂ§â", icon: "üî•" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Â§©‰∏ãÂ∏ÉÊ≠¶„ÇíÊé≤„Åí„ÅüÈù©ÂëΩÂÖê", icon: "üìú" },
                { type: "quote", label: "„ÄêÂêçË®Ä„Äë", text: "ÊòØÈùû„Å´Âèä„Å∞„Åö", icon: "üí¨" }
            ]},
            { id: "ryoma", name: "ÂùÇÊú¨ÈæçÈ¶¨", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂùÇÊú¨ÈæçÈ¶¨", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂπïÊú´", icon: "‚öì" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ëñ©Èï∑ÂêåÁõü", icon: "ü§ù" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨„ÅÆÂ§úÊòé„Åë„ÇíÂ∞é„ÅÑ„Åü", icon: "üåÖ" },
                { type: "quote", label: "„ÄêÂêçË®Ä„Äë", text: "Êó•Êú¨„ÇíÊ¥óÊøØËá¥„ÅóÂÄô", icon: "üí¨" }
            ]},
            { id: "shingen", name: "Ê≠¶Áî∞‰ø°ÁéÑ", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê≠¶Áî∞‰ø°ÁéÑ", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üêé" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â∑ù‰∏≠Â≥∂„ÅÆÊà¶„ÅÑ", icon: "‚öîÔ∏è" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Áî≤Êñê„ÅÆËôé„Å®Âëº„Å∞„Çå„ÅüÊô∫Â∞Ü", icon: "üêØ" },
                { type: "quote", label: "„ÄêÂêçË®Ä„Äë", text: "‰∫∫„ÅØÂüé„ÄÅ‰∫∫„ÅØÁü≥Âû£...", icon: "üè∞" }
            ]},
            { id: "himiko", name: "ÂçëÂº•Âëº", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂçëÂº•Âëº", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âº•ÁîüÊôÇ‰ª£", icon: "üè∫" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "È≠è„Å∏„ÅÆ‰Ωø„ÅÑ", icon: "üá®üá≥" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÈÇ™È¶¨Âè∞ÂõΩ„ÇíÊ≤ª„ÇÅ„ÅüÂ•≥Áéã", icon: "üëë" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "È¨ºÈÅì„ÇíÁî®„ÅÑ„Å¶‰∫∫„ÄÖ„ÇíÁéá„ÅÑ„Åü", icon: "üîÆ" }
            ]},
            { id: "ieyasu", name: "Âæ≥Â∑ùÂÆ∂Â∫∑", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Âæ≥Â∑ùÂÆ∂Â∫∑", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂÆâÂúüÊ°ÉÂ±±„ÄúÊ±üÊà∏", icon: "üèØ" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Èñ¢„É∂Âéü„ÅÆÊà¶„ÅÑ", icon: "‚öîÔ∏è" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∫∫Ë≥™„Åã„ÇâÂ§©‰∏ã‰∫∫", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ê±üÊà∏ÂπïÂ∫ú„ÇíÈñã„ÅÑ„Åü", icon: "üí¨" }
            ]},
            { id: "hideyoshi", name: "Ë±äËá£ÁßÄÂêâ", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ë±äËá£ÁßÄÂêâ", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂÆâÂúüÊ°ÉÂ±±ÊôÇ‰ª£", icon: "üèØ" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â§©‰∏ãÁµ±‰∏Ä", icon: "üåè" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Ëæ≤Ê∞ë„Åã„ÇâÁôª„ÇäË©∞„ÇÅ„ÅüËã±ÈõÑ", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Â§©‰∏ãÁµ±‰∏Ä„Çí„Å™„Åó„Åà„ÅüÊúÄÂàù„ÅÆ‰∫∫Áâ©", icon: "üí¨" }
            ]},
            { id: "yoshitsune", name: "Ê∫êÁæ©Áµå", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê∫êÁæ©Áµå", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊôÇ‰ª£Êú´Êúü", icon: "üéé" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â£á„ÉéÊµ¶„ÅÆÊà¶„ÅÑ", icon: "üåä" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊÇ≤Âäá„ÅÆÂ§©ÊâçÊ≠¶Â∞Ü", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂÖ´ËâòÈ£õ„Å≥Ôºà„ÅØ„Å£„Åù„ÅÜ„Å®„Å≥Ôºâ„ÄÅÈµØË∂ä„ÅÆÈÄÜËêΩ„Å®„ÅóÔºà„Å≤„Çà„Å©„Çä„Åî„Åà„ÅÆ„Åï„Åã„Åä„Å®„ÅóÔºâ", icon: "üí¨" }
            ]},
            { id: "yoritomo", name: "Ê∫êÈ†ºÊúù", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê∫êÈ†ºÊúù", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÈéåÂÄâÊôÇ‰ª£", icon: "üèπ" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÈéåÂÄâÂπïÂ∫úÂâµË®≠", icon: "üèØ" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Âàù„ÅÆÊ≠¶ÂÆ∂ÊîøÊ®©„ÇíÁØâ„ÅÑ„Åü", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Âπ≥ÂÆ∂„ÇíÊªÖ„Åº„Åô", icon: "üí¨" }
            ]},
            { id: "masamune", name: "‰ºäÈÅîÊîøÂÆó", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰ºäÈÅîÊîøÂÆó", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩ„ÄúÊ±üÊà∏ÊôÇ‰ª£", icon: "‚öîÔ∏è" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÊÖ∂Èï∑ÈÅ£Ê¨ß‰ΩøÁØÄ", icon: "üö¢" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Áã¨ÁúºÁ´ú„Å®Áß∞„Åï„Çå„ÅüÂêçÂ∞Ü", icon: "üêâ" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "‰ªôÂè∞Ëó©Ëó©‰∏ª", icon: "üí¨" }
            ]},
            { id: "saigo", name: "Ë•øÈÉ∑ÈöÜÁõõ", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ë•øÈÉ∑ÈöÜÁõõ", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂπïÊú´„ÄúÊòéÊ≤ª", icon: "üéå" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ë•øÂçóÊà¶‰∫â", icon: "üî•" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊúÄÂæå„ÅÆ‰æç„ÄÅÁ∂≠Êñ∞„ÅÆËã±ÈõÑ", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ëñ©Èï∑ÂêåÁõü„ÅÆÁ∑†Áµê„ÇÑÊ±üÊà∏ÂüéÁÑ°Ë°ÄÈñãÂüé„ÅÆÂÆüÁèæ", icon: "üí¨" }
            ]},
            { id: "okita", name: "Ê≤ñÁî∞Á∑èÂè∏", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê≤ñÁî∞Á∑èÂè∏", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂπïÊú´", icon: "‚öîÔ∏è" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Êñ∞ÈÅ∏ÁµÑÁµêÊàê", icon: "üó°Ô∏è" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êñ∞ÈÅ∏ÁµÑÊúÄÂº∑„ÅÆÂâ£Â£´", icon: "üìú" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Êñ∞ÈÅ∏ÁµÑ‰∏ÄÁï™ÈöäÈöäÈï∑", icon: "üí¨" }
            ]},
            { id: "shotoku", name: "ËÅñÂæ≥Â§™Â≠ê", cards: [
                { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ËÅñÂæ≥Â§™Â≠ê", icon: "üë§" },
                { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "È£õÈ≥•ÊôÇ‰ª£", icon: "‚õ©Ô∏è" },
                { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÂçÅ‰∏ÉÊù°„ÅÆÊÜ≤Ê≥ï„ÇíÂà∂ÂÆö", icon: "üìú" },
                { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÂõΩÂÆ∂‰ΩìÂà∂„ÇíÊï¥„Åà„ÅüÊÄùÊÉ≥ÂÆ∂", icon: "üß†" },
                { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÊëÇÊîø„Å®„Å™„ÇäÊé®Âè§Â§©Áöá„ÇíÊîØ„Åà„Åü", icon: "üí¨" }
            ]},
{ id: "tenmu", name: "Â§©Ê≠¶Â§©Áöá", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Â§©Ê≠¶Â§©Áöá", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "È£õÈ≥•ÊôÇ‰ª£", icon: "‚õ©Ô∏è" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â£¨Áî≥„ÅÆ‰π±", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∏≠Â§ÆÈõÜÊ®©ÂõΩÂÆ∂„ÇíÁ¢∫Á´ã„Åó„ÅüÂ§©Áöá", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Âæã‰ª§ÂõΩÂÆ∂‰ΩìÂà∂„ÅÆÂü∫Á§éÊßãÁØâ", icon: "üí¨" }
]},
{ id: "nakatomi_kamatari", name: "‰∏≠Ëá£ÈéåË∂≥", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰∏≠Ëá£ÈéåË∂≥", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "È£õÈ≥•ÊôÇ‰ª£", icon: "‚õ©Ô∏è" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "‰πôÂ∑≥„ÅÆÂ§â", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊîπÈù©ÊîøÊ≤ª„Çí‰∏ªÂ∞é„Åó„ÅüÁü•Áï•ÂÆ∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Â§ßÂåñÊîπÊñ∞„ÅÆ‰∏≠ÂøÉ‰∫∫Áâ©„ÅÆ‰∏Ä‰∫∫„ÄÅËó§ÂéüÊ∞è", icon: "üí¨" }
]},
{ id: "kanmu", name: "Ê°ìÊ≠¶Â§©Áöá", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê°ìÊ≠¶Â§©Áöá", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Âπ≥ÂÆâ‰∫¨ÈÅ∑ÈÉΩ", icon: "üèõÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êñ∞ÈÉΩÂª∫Ë®≠„ÅßÊîøÊ≤ªÂà∑Êñ∞„ÇíÂõ≥„Å£„ÅüÂ§©Áöá", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Èï∑Â≤°‰∫¨„ÉªÂπ≥ÂÆâ‰∫¨ÈÅ∑ÈÉΩ", icon: "üí¨" }
]},
{ id: "sugawara", name: "ËèÖÂéüÈÅìÁúü", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ËèÖÂéüÈÅìÁúü", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÈÅ£Âîê‰ΩøÂªÉÊ≠¢", icon: "üìú" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Â≠¶Âïè„ÇíÈáç„Çì„Åò„ÅüÂø†Ëá£", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Â≠¶Âïè„ÅÆÁ•û„Å®„Åó„Å¶‰ø°‰ª∞", icon: "üí¨" }
]},
{ id: "murasaki", name: "Á¥´ÂºèÈÉ®", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Á¥´ÂºèÈÉ®", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ê∫êÊ∞èÁâ©Ë™ûÂü∑Á≠Ü", icon: "üìñ" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∏ñÁïåÊúÄÂè§„ÅÆÈï∑Á∑®Â∞èË™¨‰ΩúÂÆ∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ê∫êÊ∞èÁâ©Ë™û", icon: "üí¨" }
]},
{ id: "kiyomori", name: "Âπ≥Ê∏ÖÁõõ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Âπ≥Ê∏ÖÁõõ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ê≠¶Â£´ÊîøÊ®©Ê®πÁ´ã", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Âàù„ÅÆÊ≠¶Â£´Âá∫Ë∫´Â§™ÊîøÂ§ßËá£", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Êó•ÂÆãË≤øÊòìÊé®ÈÄ≤", icon: "üí¨" }
]},
{ id: "yoritomo", name: "Ê∫êÈ†ºÊúù", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê∫êÈ†ºÊúù", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÈéåÂÄâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÈéåÂÄâÂπïÂ∫úÊàêÁ´ã", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Ê≠¶ÂÆ∂ÊîøÊ®©„ÇíÁ¢∫Á´ã„Åó„ÅüÂ∞ÜËªç", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂæÅÂ§∑Â§ßÂ∞ÜËªçÂ∞±‰ªª", icon: "üí¨" }
]},
{ id: "yoshitsune", name: "Ê∫êÁæ©Áµå", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê∫êÁæ©Áµå", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Âπ≥ÂÆâÊú´Êúü", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â£á„ÉéÊµ¶„ÅÆÊà¶„ÅÑ", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊÇ≤Âäá„ÅÆÂ§©ÊâçÊ≠¶Â∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Âπ≥Ê∞èÊªÖ‰∫°„Å´Ë≤¢ÁåÆ", icon: "üí¨" }
]},
{ id: "hojo_tokimune", name: "ÂåóÊù°ÊôÇÂÆó", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂåóÊù°ÊôÇÂÆó", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÈéåÂÄâÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÂÖÉÂØá", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÂõΩÈõ£„Å´Á´ã„Å°Âêë„Åã„Å£„ÅüÂü∑Ê®©", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ËíôÂè§Ë•≤Êù•ÊíÉÈÄÄ", icon: "üí¨" }
]},
{ id: "ashikaga_takauji", name: "Ë∂≥Âà©Â∞äÊ∞è", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ë∂≥Âà©Â∞äÊ∞è", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂÆ§Áî∫ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÂÆ§Áî∫ÂπïÂ∫úÊàêÁ´ã", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êñ∞ÂπïÂ∫ú„ÇíÈñã„ÅÑ„ÅüÊ≠¶Â∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂæÅÂ§∑Â§ßÂ∞ÜËªçÂ∞±‰ªª", icon: "üí¨" }
]},
{ id: "oda_nobunaga", name: "ÁπîÁî∞‰ø°Èï∑", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÁπîÁî∞‰ø°Èï∑", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â§©‰∏ãÂ∏ÉÊ≠¶", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Èù©Êñ∞ÁöÑ„Å™Êà¶ÂõΩÊ≠¶Â∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ê•ΩÂ∏ÇÊ•ΩÂ∫ß„ÄÅÊØîÂè°Â±±ÁÑºË®é", icon: "üí¨" }
]},
{ id: "toyotomi_hideyoshi", name: "Ë±äËá£ÁßÄÂêâ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ë±äËá£ÁßÄÂêâ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂÆâÂúüÊ°ÉÂ±±ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â§©‰∏ãÁµ±‰∏Ä", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Ëæ≤Ê∞ë„Åã„ÇâÂ§©‰∏ã‰∫∫„Å´„Å™„Å£„ÅüËã±ÈõÑ", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂàÄÁã©„ÄÅÂ§™Èñ§Ê§úÂú∞", icon: "üí¨" }
]},
{ id: "tokugawa_ieyasu", name: "Âæ≥Â∑ùÂÆ∂Â∫∑", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Âæ≥Â∑ùÂÆ∂Â∫∑", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Ê±üÊà∏ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ê±üÊà∏ÂπïÂ∫úÊàêÁ´ã", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Èï∑ÊúüÊîøÊ®©„ÇíÁØâ„ÅÑ„ÅüÂ∞ÜËªç", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Èñ¢„É∂Âéü„ÅÆÊà¶„ÅÑÂãùÂà©", icon: "üí¨" }
]},
{ id: "ryoma", name: "ÂùÇÊú¨ÈæçÈ¶¨", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂùÇÊú¨ÈæçÈ¶¨", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂπïÊú´", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â§ßÊîøÂ•âÈÇÑ", icon: "üìú" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊôÇ‰ª£„ÇíÂãï„Åã„Åó„ÅüÈ¢®Èõ≤ÂÖê", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ëñ©Èï∑ÂêåÁõü‰ª≤‰ªã", icon: "üí¨" }
]},
{ id: "saigo", name: "Ë•øÈÉ∑ÈöÜÁõõ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ë•øÈÉ∑ÈöÜÁõõ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÂπïÊú´„ÉªÊòéÊ≤ª", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÊòéÊ≤ªÁ∂≠Êñ∞", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Á∂≠Êñ∞„ÇíÂ∞é„ÅÑ„ÅüÊ≠¶Â£´", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Êñ∞ÊîøÂ∫úÊ®πÁ´ã„Å´Ë≤¢ÁåÆ", icon: "üí¨" }
]},
{ id: "okubo", name: "Â§ß‰πÖ‰øùÂà©ÈÄö", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Â§ß‰πÖ‰øùÂà©ÈÄö", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ªÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ëøë‰ª£ÂõΩÂÆ∂Âª∫Ë®≠", icon: "üèõÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Ëøë‰ª£Êó•Êú¨„ÅÆË®≠Ë®àËÄÖ", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂªÉËó©ÁΩÆÁúåÊé®ÈÄ≤", icon: "üí¨" }
]},
{ id: "fukuzawa", name: "Á¶èÊ≤¢Ë´≠Âêâ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Á¶èÊ≤¢Ë´≠Âêâ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ªÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â≠¶Âïè„ÅÆ„Åô„Åô„ÇÅÂàäË°å", icon: "üìñ" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÂïìËíôÊÄùÊÉ≥ÂÆ∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÊÖ∂ÊáâÁæ©Â°æÂâµË®≠", icon: "üí¨" }
]},
{ id: "itoshi", name: "‰ºäËó§ÂçöÊñá", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰ºäËó§ÂçöÊñá", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ªÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â§ßÊó•Êú¨Â∏ùÂõΩÊÜ≤Ê≥ïÂà∂ÂÆö", icon: "üìú" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Âàù‰ª£ÂÜÖÈñ£Á∑èÁêÜÂ§ßËá£", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Á´ãÊÜ≤ÂõΩÂÆ∂Á¢∫Á´ã", icon: "üí¨" }
]},
{ id: "yamagata", name: "Â±±Á∏£ÊúâÊúã", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Â±±Á∏£ÊúâÊúã", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ªÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Âæ¥ÂÖµ‰ª§Âà∂ÂÆö", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨Èô∏Ëªç„ÅÆÁà∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ëøë‰ª£ËªçÂà∂Á¢∫Á´ã", icon: "üí¨" }
]},
{ id: "nitobe", name: "Êñ∞Ê∏°Êà∏Á®≤ÈÄ†", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Êñ∞Ê∏°Êà∏Á®≤ÈÄ†", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ª„ÉªÂ§ßÊ≠£ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ê≠¶Â£´ÈÅìÂàäË°å", icon: "üìñ" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨ÊñáÂåñ„Çí‰∏ñÁïå„Å´‰ºù„Åà„ÅüÊÄùÊÉ≥ÂÆ∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂõΩÈöõÈÄ£Áõü‰∫ãÂãôÊ¨°Èï∑", icon: "üí¨" }
]},
{ id: "natsume", name: "Â§èÁõÆÊº±Áü≥", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Â§èÁõÆÊº±Áü≥", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ªÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ëøë‰ª£ÊñáÂ≠¶Á¢∫Á´ã", icon: "üìñ" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨Ëøë‰ª£ÊñáÂ≠¶„ÅÆÂ∑®Âå†", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂêæËº©„ÅØÁå´„Åß„ÅÇ„Çã„ÄÅ„Åì„Åì„Çç", icon: "üí¨" }
]},
{ id: "akiko", name: "‰∏éË¨ùÈáéÊô∂Â≠ê", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰∏éË¨ùÈáéÊô∂Â≠ê", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ª„ÉªÂ§ßÊ≠£ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Êñ∞„Åó„ÅÑÂ•≥ÊÄßÂÉè„ÅÆÊèêÁ§∫", icon: "üìñ" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊÉÖÁÜ±ÁöÑ„Å™Ê≠å‰∫∫„ÉªÊÄùÊÉ≥ÂÆ∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "„Åø„Å†„ÇåÈ´™", icon: "üí¨" }
]},
{ id: "yoshida", name: "ÂêâÁî∞ËåÇ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂêâÁî∞ËåÇ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Êà¶ÂæåÂæ©Ëàà", icon: "üèõÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êà¶ÂæåÊó•Êú¨Â§ñ‰∫§„ÅÆÂü∫Á§é„ÇíÁØâ„ÅÑ„ÅüÈ¶ñÁõ∏", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Êó•Á±≥ÂÆâÂÖ®‰øùÈöú‰ΩìÂà∂ÊßãÁØâ", icon: "üí¨" }
]},
{ id: "ozaki", name: "Â∞æÂ¥éË°åÈõÑ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Â∞æÂ¥éË°åÈõÑ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ª„ÉªÂ§ßÊ≠£„ÉªÊò≠Âíå", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ë≠∞‰ºöÊîøÊ≤ªÁô∫Â±ï", icon: "üèõÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊÜ≤Êîø„ÅÆÁ•ûÊßò", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Á´ãÊÜ≤ÊîøÊ≤ª„ÅÆÁ¢∫Á´ã", icon: "üí¨" }
]},
{ id: "shibusawa", name: "Ê∏ãÊ≤¢Ê†Ñ‰∏Ä", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê∏ãÊ≤¢Ê†Ñ‰∏Ä", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ª„ÉªÂ§ßÊ≠£ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ëøë‰ª£ÁµåÊ∏àÁô∫Â±ï", icon: "üíº" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨Ë≥áÊú¨‰∏ªÁæ©„ÅÆÁà∂", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Á¨¨‰∏ÄÂõΩÁ´ãÈäÄË°åË®≠Á´ã„ÄÅ‰∏Ä‰∏áÂÜÜÊú≠", icon: "üí¨" }
]},
{ id: "hattori", name: "ÊúçÈÉ®ÂçäËîµ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÊúçÈÉ®ÂçäËîµ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "‰ºäË≥ÄÂøçËÄÖÊ¥ªË∫ç", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Âæ≥Â∑ùÂÆ∂„ÇíÊîØ„Åà„ÅüÂøçÂ∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂÆ∂Â∫∑„ÅÆÂëΩ„ÇíÊïë„ÅÜ", icon: "üí¨" }
]},
{ id: "date_masamune", name: "‰ºäÈÅîÊîøÂÆó", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰ºäÈÅîÊîøÂÆó", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩ„ÉªÊ±üÊà∏ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "‰ªôÂè∞Ëó©ÊàêÁ´ã", icon: "üè∞" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Áã¨ÁúºÁ´ú„Å®Âëº„Å∞„Çå„ÅüÂêçÂ∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÊîØÂÄâÂ∏∏Èï∑Ê¨ßÂ∑ûÊ¥æÈÅ£", icon: "üí¨" }
]},
{ id: "takeda_shingen", name: "Ê≠¶Áî∞‰ø°ÁéÑ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Ê≠¶Áî∞‰ø°ÁéÑ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â∑ù‰∏≠Â≥∂„ÅÆÊà¶„ÅÑ", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êà¶ÂõΩÊúÄÂº∑„Å®Áß∞„Åï„Çå„ÅüÂêçÂ∞Ü", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "È¢®ÊûóÁÅ´Â±±„ÅÆËªçÁï•", icon: "üí¨" }
]},
{ id: "uesugi_kenshin", name: "‰∏äÊùâË¨ô‰ø°", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "‰∏äÊùâË¨ô‰ø°", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Â∑ù‰∏≠Â≥∂„ÅÆÊà¶„ÅÑ", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Áæ©„ÇíÈáç„Çì„Åò„ÅüËªçÁ•û", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Ë∂äÂæåÁµ±‰∏Ä„ÄÅÈñ¢Êù±Âá∫ÂÖµ", icon: "üí¨" }
]},
{ id: "hojo_soun", name: "ÂåóÊù°Êó©Èõ≤", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÂåóÊù°Êó©Èõ≤", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êà¶ÂõΩÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "‰∏ãÂâã‰∏äÊàêÂäü", icon: "‚öîÔ∏è" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êà¶ÂõΩÂ§ßÂêç„ÅÆÂÖàÈßÜËÄÖ", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÂæåÂåóÊù°Ê∞è„ÅÆÂü∫Á§éÁØâ„Åè", icon: "üí¨" }
]},
{ id: "emperor_showa", name: "Êò≠ÂíåÂ§©Áöá", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Êò≠ÂíåÂ§©Áöá", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÁµÇÊà¶", icon: "üìú" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÊøÄÂãï„ÅÆÊôÇ‰ª£„ÇíÁîü„Åç„ÅüÂ§©Áöá", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÁéâÈü≥ÊîæÈÄÅ", icon: "üí¨" }
]},
{ id: "tezuka", name: "ÊâãÂ°öÊ≤ªËô´", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÊâãÂ°öÊ≤ªËô´", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Êº´ÁîªÊñáÂåñÁô∫Â±ï", icon: "üé®" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "Êó•Êú¨Êº´Áîª„ÅÆÁ•ûÊßò", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÈâÑËÖï„Ç¢„Éà„É†„ÄÅÁÅ´„ÅÆÈ≥•", icon: "üí¨" }
]},
{ id: "kurosawa", name: "ÈªíÊæ§Êòé", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÈªíÊæ§Êòé", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "‰∏ñÁïåÁöÑÊò†ÁîªË©ï‰æ°", icon: "üé¨" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∏ñÁïå„Å´ÂΩ±Èüø„Çí‰∏é„Åà„ÅüÊò†ÁîªÁõ£Áù£", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "‰∏É‰∫∫„ÅÆ‰æç„ÄÅÁæÖÁîüÈñÄ", icon: "üí¨" }
]},
{ id: "honda_soichiro", name: "Êú¨Áî∞ÂÆó‰∏ÄÈÉé", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Êú¨Áî∞ÂÆó‰∏ÄÈÉé", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "Ëá™ÂãïËªäÁî£Ê•≠Áô∫Â±ï", icon: "üöó" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∏ñÁïå‰ºÅÊ•≠„ÇíÁØâ„ÅÑ„ÅüÊäÄË°ìËÄÖ", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "Êú¨Áî∞ÊäÄÁ†îÂ∑•Ê•≠ÂâµÊ•≠", icon: "üí¨" }
]},
{ id: "matsushita", name: "Êùæ‰∏ãÂπ∏‰πãÂä©", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "Êùæ‰∏ãÂπ∏‰πãÂä©", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "Êò≠ÂíåÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÂÆ∂ÈõªÁî£Ê•≠ÊàêÈï∑", icon: "üí°" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "ÁµåÂñ∂„ÅÆÁ•ûÊßò", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "„Éë„Éä„ÇΩ„Éã„ÉÉ„ÇØÂâµÊ•≠", icon: "üí¨" }
]},
{ id: "nande", name: "ÈáéÂè£Ëã±‰∏ñ", cards: [
    { type: "name", label: "„Äê‰∫∫Áâ©„Äë", text: "ÈáéÂè£Ëã±‰∏ñ", icon: "üë§" },
    { type: "era", label: "„ÄêÊôÇ‰ª£„Äë", text: "ÊòéÊ≤ª„ÉªÂ§ßÊ≠£ÊôÇ‰ª£", icon: "üèØ" },
    { type: "event", label: "„ÄêÂá∫Êù•‰∫ã„Äë", text: "ÂåªÂ≠¶Á†îÁ©∂", icon: "üß™" },
    { type: "desc", label: "„ÄêÊ¶ÇË¶Å„Äë", text: "‰∏ñÁïå„ÅßÊ¥ªË∫ç„Åó„ÅüÂåªÂ≠¶ËÄÖ", icon: "üß†" },
    { type: "quote", label: "„ÄêÊ•≠Á∏æ„Äë", text: "ÈªÑÁÜ±ÁóÖÁ†îÁ©∂", icon: "üí¨" }
]}

        ];

        /**
         * Main Application
         */
        const app = {
            deck: [],
            hand: [],
            selected: new Set(),
            turn: 0,
            maxTurns: 3,
            currentHeroes: [], 
            isProcessing: false,
            collection: JSON.parse(localStorage.getItem('chrono_data') || '{}'),

            goHome: function() {
                document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
                document.getElementById('start-screen').classList.remove('hidden');
                AudioEngine.play('select');
            },

            startStory: function() {
                AudioEngine.init();
                AudioEngine.play('select');
                document.getElementById('start-screen').classList.add('hidden');
                const screen = document.getElementById('story-screen');
                screen.classList.remove('hidden');
                const btn = document.getElementById('story-next-btn');
                btn.classList.add('hidden');
                
                const text = "Ë•øÊö¶30XXÂπ¥„ÄÇ\nÊ≠¥Âè≤„Éá„Éº„Çø„ÅåÊ∑∑Á∑ö„Åó„Å¶„ÅÑ„Çã„ÄÇ\nÂêõ„ÅØ„ÄåÊôÇÁ©∫„ÅÆÁ∑®Á∫ÇËÄÖ„Äç„ÄÇ\nÊôÇÁ©∫„ÅÆÁã≠Èñì„Åã„Çâ„Äê4‰∫∫„ÅÆËã±ÈõÑ„Äë„ÅÆË®òÈå≤„Çí\nÈÅ∏Âá∫„Åó„ÄÅÊ≠£„Åó„ÅèÂàÜÈ°û„Åõ„Çà„ÄÇ\n\nÊâãÊéõ„Åã„Çä„ÅØ„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Åø„ÄÇ\nÈÅãÂëΩ„Çí„ÄÅÈÅ∏„Å≥Âèñ„Çå„ÄÇ";
                const p = document.getElementById('story-text');
                p.innerHTML = '';
                p.classList.add('typing-cursor');

                let i = 0;
                const typeInterval = setInterval(() => {
                    if (i < text.length) {
                        p.textContent += text.charAt(i);
                        if(text.charAt(i) !== '\n' && i%2===0) AudioEngine.play('type');
                        i++;
                    } else {
                        clearInterval(typeInterval);
                        p.classList.remove('typing-cursor');
                        btn.classList.remove('hidden');
                    }
                }, 35);
            },

            startGame: function(sameHeroes = false) {
                if (this.isProcessing) return;
                AudioEngine.play('select');
                document.querySelectorAll('.overlay').forEach(e => e.classList.add('hidden'));
                document.getElementById('result-box').classList.remove('show');
                
                if (!sameHeroes || this.currentHeroes.length === 0) {
                    this.currentHeroes = this.shuffle([...HISTORY_DB]).slice(0, 4);
                }

                const gameCards = [];
                this.currentHeroes.forEach(h => {
                    h.cards.forEach(c => gameCards.push({...c, heroId: h.id}));
                });
                
                this.deck = this.shuffle([...gameCards]);
                this.hand = [];
                this.turn = this.maxTurns;
                this.selected.clear();
                
                const container = document.getElementById('hand-container');
                container.innerHTML = '';
                this.updateControls();
                
                this.dealOneByOne();
            },

            dealOneByOne: async function() {
                this.isProcessing = true;
                for(let i=0; i<5; i++) {
                    if(this.deck.length > 0) this.hand.push(this.deck.pop());
                }

                const container = document.getElementById('hand-container');
                for(let i=0; i<this.hand.length; i++) {
                    await new Promise(r => setTimeout(r, 120));
                    AudioEngine.play('deal');
                    this.renderCard(i, true);
                }
                this.isProcessing = false;
                this.updateControls();
            },

            shuffle: function(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            renderCard: function(index, isDealing = false) {
                const container = document.getElementById('hand-container');
                const card = this.hand[index];
                if (!card) return;

                const div = document.createElement('div');
                div.className = `card ${this.selected.has(index) ? 'selected' : ''}`;
                if(isDealing) div.classList.add('dealing');

                const rot = (index - 2) * 5; 
                const ty = Math.abs(index - 2) * 5;
                if(!this.selected.has(index)) {
                    div.style.transform = `rotate(${rot}deg) translateY(${ty}px)`;
                }

                div.onclick = () => this.toggleSelect(index);
                div.innerHTML = `
                    <div class="card-inner">
                        <div style="font-size:0.65rem; color:#666; width:100%; border-bottom:1px solid #ddd; padding-bottom:3px;">${card.label}</div>
                        <div class="c-icon">${card.icon}</div>
                        <div class="c-text">${card.text}</div>
                        <div class="c-footer">HISTORICAL DATA</div>
                    </div>
                `;
                
                if (container.children[index]) {
                    container.replaceChild(div, container.children[index]);
                } else {
                    container.appendChild(div);
                }
            },

            toggleSelect: function(index) {
                if (this.isProcessing || this.turn <= 0) return;
                AudioEngine.play('select');
                if (this.selected.has(index)) {
                    this.selected.delete(index);
                } else {
                    this.selected.add(index);
                }
                this.refreshHandView();
                this.updateControls();
            },

            refreshHandView: function() {
                const container = document.getElementById('hand-container');
                Array.from(container.children).forEach((div, i) => {
                    div.classList.remove('matched', 'dimmed');
                    const rot = (i - 2) * 5;
                    const ty = Math.abs(i - 2) * 5;
                    
                    if (this.selected.has(i)) {
                        div.classList.add('selected');
                        div.style.transform = 'translateY(-50px) rotate(0deg)';
                    } else {
                        div.classList.remove('selected');
                        div.style.transform = `rotate(${rot}deg) translateY(${ty}px)`;
                    }
                });
            },

            handleSwap: async function() {
                if (this.isProcessing || this.turn <= 0 || this.selected.size === 0) return;
                if (this.deck.length < this.selected.size) {
                    alert("„Åì„Çå‰ª•‰∏ä„Ç´„Éº„Éâ„ÇíÂºï„Åë„Åæ„Åõ„ÇìÔºÅÔºàÂ±±Êú≠Âàá„ÇåÔºâ");
                    return;
                }

                this.isProcessing = true;
                const container = document.getElementById('hand-container');
                const selectedIndices = Array.from(this.selected).sort((a,b) => b-a);
                
                // 1. Êç®„Å¶„Çã„Ç´„Éº„Éâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                AudioEngine.play('swap');
                selectedIndices.forEach(idx => {
                    if(container.children[idx]) {
                        container.children[idx].classList.add('discarding');
                        container.children[idx].classList.remove('selected');
                    }
                });

                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂæÖ„Å§
                await new Promise(r => setTimeout(r, 600));

                // 2. „Éá„Éº„ÇøÊõ¥Êñ∞
                const newHand = [...this.hand];
                selectedIndices.forEach(idx => {
                    newHand[idx] = this.deck.pop(); 
                });
                this.hand = newHand;
                this.selected.clear();
                this.turn--;

                // 3. Êñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Çí„Äå„Éâ„É≠„ÉºÊºîÂá∫„Äç„ÅßËøΩÂä†
                // ÂÖà„Å´Á©∫„ÅÆË¶ÅÁ¥†„Å´„Åó„Å¶„Åã„Çâ„ÄÅdrawing„ÇØ„É©„Çπ‰ªò„Åç„ÅßÂÜçÊèèÁîª„Åô„Çã„Åì„Å®„Åß„ÄåËêΩ„Å°„Å¶„Åè„Çã„ÄçÊÑü„Çí‰Ωú„Çã
                selectedIndices.forEach(idx => {
                    const card = this.hand[idx];
                    const div = document.createElement('div');
                    div.className = 'card drawing';
                    
                    const rot = (idx - 2) * 5;
                    const ty = Math.abs(idx - 2) * 5;
                    div.style.transform = `rotate(${rot}deg) translateY(${ty}px)`;

                    div.onclick = () => this.toggleSelect(idx);
                    div.innerHTML = `
                        <div class="card-inner">
                            <div style="font-size:0.65rem; color:#666; width:100%; border-bottom:1px solid #ddd; padding-bottom:3px;">${card.label}</div>
                            <div class="c-icon">${card.icon}</div>
                            <div class="c-text">${card.text}</div>
                            <div class="c-footer">HISTORICAL DATA</div>
                        </div>
                    `;
                    container.replaceChild(div, container.children[idx]);
                });
                
                AudioEngine.play('deal');
                this.isProcessing = false;
                this.updateControls();
            },

            handleJudge: function() {
                if (this.isProcessing) return;
                this.isProcessing = true;
                const analyzeScreen = document.getElementById('analyzing-screen');
                analyzeScreen.classList.remove('hidden');
                
                let beats = 0;
                const beatInterval = setInterval(() => {
                    AudioEngine.play('heartbeat');
                    beats++;
                    if(beats >= 4) clearInterval(beatInterval);
                }, 800);

                setTimeout(() => {
                    analyzeScreen.classList.add('hidden');
                    this.calculateResult();
                    this.isProcessing = false;
                }, 3500);
            },

            // ‚òÖ ‰øÆÊ≠£Ôºö„ÉÜ„Ç≠„Çπ„ÉàÂÜÖÂÆπ‰∏ÄËá¥Âà§ÂÆö„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ
            calculateResult: function() {
                let bestHero = null;
                let maxMatches = 0;

                // Â†¥„ÅÆ4‰∫∫„ÅÆÂÅâ‰∫∫„Åù„Çå„Åû„Çå„Å´„Å§„ÅÑ„Å¶„ÄÅÊâãÊú≠„Å®„ÅÆ„Äå„ÉÜ„Ç≠„Çπ„Éà‰∏ÄËá¥Êï∞„Äç„ÇíË®àÁÆó„Åô„Çã
                this.currentHeroes.forEach(hero => {
                    let matches = 0;
                    this.hand.forEach(handCard => {
                        // ÂÅâ‰∫∫„ÅÆ„Ç´„Éº„Éâ„É™„Çπ„Éà„ÅÆ‰∏≠„Å´„ÄÅÊâãÊú≠„Ç´„Éº„Éâ„Å®Âêå„Åò„ÉÜ„Ç≠„Çπ„Éà„Éª„Çø„Ç§„Éó„ÅÆ„ÇÇ„ÅÆ„Åå„ÅÇ„Çã„ÅãÔºü
                        const isMatch = hero.cards.some(c => c.type === handCard.type && c.text === handCard.text);
                        if (isMatch) matches++;
                    });

                    if (matches > maxMatches) {
                        maxMatches = matches;
                        bestHero = hero;
                    }
                });

                // 3Êûö‰ª•‰∏ä„Å™„ÇâÊàêÂäü
                const isSuccess = maxMatches >= 3;
                
                // ÊºîÂá∫Ôºö„ÉÜ„Ç≠„Çπ„Éà„Åå‰∏ÄËá¥„Åô„Çã„Ç´„Éº„Éâ„ÇíÂÖâ„Çâ„Åõ„ÇãÔºàID„Åß„ÅØ„Å™„Åè„ÉÜ„Ç≠„Çπ„ÉàÂà§ÂÆöÔºâ
                const container = document.getElementById('hand-container');
                Array.from(container.children).forEach((div, i) => {
                    const handCard = this.hand[i];
                    // „Éô„Çπ„Éà„Éû„ÉÉ„ÉÅ„Åó„ÅüÂÅâ‰∫∫„Å´„Å®„Å£„Å¶„ÄåÊ≠£Ëß£„Äç„Å®„Å™„Çã„Ç´„Éº„Éâ„ÅãÂà§ÂÆö
                    const isCorrectCard = bestHero && bestHero.cards.some(c => c.type === handCard.type && c.text === handCard.text);

                    if (isSuccess && isCorrectCard) {
                        div.classList.add('matched'); 
                    } else {
                        div.classList.add('dimmed');
                    }
                });

                // „É™„Ç∂„É´„ÉàË°®Á§∫
                setTimeout(() => {
                    const resultBox = document.getElementById('result-box');
                    const screen = document.getElementById('result-screen');
                    const title = document.getElementById('result-title');
                    const desc = document.getElementById('result-desc');
                    const rank = document.getElementById('rank-display');
                    const review = document.getElementById('result-review');
                    
                    // --- Á≠î„ÅàÂêà„Çè„Åõ„É™„Çπ„ÉàÁîüÊàêÔºà„ÉÜ„Ç≠„Çπ„ÉàÂà§ÂÆöÁâàÔºâ ---
                    let reviewHTML = `<div style="font-weight:bold; margin-bottom:5px; color:#333; border-bottom:1px solid #ccc; padding-bottom:5px;">„ÄêÊâãÊú≠„ÅÆËß£Êûê„É¨„Éù„Éº„Éà„Äë</div>`;
                    reviewHTML += `<ul class="review-list">`;
                    
                    this.hand.forEach(card => {
                        // „Åì„ÅÆ„Ç´„Éº„Éâ„ÅÆÊú¨Êù•„ÅÆÊåÅ„Å°‰∏ª
                        const trueOwner = HISTORY_DB.find(h => h.id === card.heroId);
                        
                        // „Éô„Çπ„ÉàÂÅâ‰∫∫„ÅÆÊ≠£Ëß£„Éá„Éº„Çø„Å´Âê´„Åæ„Çå„Çã„ÅãÔºà„ÉÜ„Ç≠„Çπ„Éà‰∏ÄËá¥Ôºâ
                        const isMatch = bestHero && bestHero.cards.some(c => c.type === card.type && c.text === card.text);
                        
                        // IDËá™‰Ωì„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Çã„ÅãÔºàÊ≥®ÈáàÁî®Ôºâ
                        const isIdMatch = bestHero && (card.heroId === bestHero.id);

                        const color = isMatch ? "var(--accent-blue)" : (isSuccess ? "#cc5555" : "#666");
                        const mark = isMatch ? "‚≠ï" : "‚ùå";
                        const weight = isMatch ? "bold" : "normal";
                        
                        let note = "";
                        if (isMatch && !isIdMatch) {
                            note = `<span style="font-size:0.7rem; color:#d66;">(‚Äª${trueOwner.name}„ÅÆË®òÈå≤„Å†„ÅåÂÜÖÂÆπ„ÅØ‰∏ÄËá¥)</span>`;
                        } else if (!isMatch) {
                            note = `<div style="font-size:0.75rem; color:#888; margin-left:24px;">‚Üí Ê≠£Ëß£: ${trueOwner.name}</div>`;
                        }

                        reviewHTML += `<li class="review-item">
                            <span style="color:${color}; font-weight:bold; font-size:1rem; margin-right:5px;">${mark}</span>
                            <span style="font-weight:${weight};">${card.text}</span>
                            ${note}
                        </li>`;
                    });
                    reviewHTML += `</ul>`;
                    review.innerHTML = reviewHTML;
                    // -------------------------

                    if (isSuccess) {
                        document.getElementById('flash-overlay').classList.add('flash-anim');
                        setTimeout(()=>document.getElementById('flash-overlay').classList.remove('flash-anim'), 1000);

                        AudioEngine.play('win');
                        // „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥‰øùÂ≠òÔºàID„ÅåÈÅï„Å£„Å¶„ÇÇ„ÄÅÊ≠£Ëß£„Å®„Åó„Å¶Êâ±„Çè„Çå„Åü„Çâ„Åù„ÅÆÂÅâ‰∫∫„ÅÆ„Ç´„Éº„Éâ„Å®„Åó„Å¶‰øùÂ≠ò„Åô„ÇãÔºâ
                        // ‚Äª„Åü„Å†„ÅóÂõ≥Èëë„ÅÆÊï¥ÂêàÊÄß„Çí‰øù„Å§„Åü„ÇÅ„ÄÅ„Ç´„Éº„ÉâÊú¨Êù•„ÅÆID„Åß‰øùÂ≠ò„Åô„Çã
                        this.hand.forEach(c => {
                            // „ÉÜ„Ç≠„Çπ„Éà‰∏ÄËá¥„Åó„Å¶„ÅÑ„Çã„Å™„Çâ„ÄÅ„Éô„Çπ„ÉàÂÅâ‰∫∫„ÅÆ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Å®„Åó„Å¶„Ç¢„É≥„É≠„ÉÉ„ÇØÊâ±„ÅÑ„Å´„Åô„Çã
                            // Ôºà„Ç≤„Éº„É†‰ΩìÈ®ì„Å®„Åó„Å¶„ÅØ„Äå„Åì„ÅÆÂÅâ‰∫∫„ÅÆÊÉÖÂ†±„ÇíÁü•„Å£„Åü„Äç„Åì„Å®„Å´„Å™„Çã„Åü„ÇÅÔºâ
                            if (bestHero.cards.some(bhc => bhc.text === c.text)) {
                                this.collection[`${bestHero.id}_${c.type}`] = true;
                            }
                        });
                        localStorage.setItem('chrono_data', JSON.stringify(this.collection));
                        
                        rank.textContent = maxMatches === 5 ? "SS" : maxMatches === 4 ? "S" : "A";
                        rank.style.borderColor = "var(--accent-red)";
                        rank.style.color = "var(--accent-red)";
                        title.textContent = "Ê≠¥Âè≤‰øÆÂæ©ÂÆå‰∫ÜÔºÅ";
                        desc.innerHTML = `„ÅäË¶ã‰∫ã„Åß„Åô„ÄÇ<br><strong>${bestHero.name}</strong>„ÅÆË®òÈå≤(${maxMatches}Êûö)„ÇíÁâπÂÆö„Åó„Åæ„Åó„Åü„ÄÇ<br>ÊôÇÁ©∫„ÅÆÊ≠™„Åø„Åå‰øÆÊ≠£„Åï„Çå„Åæ„Åó„Åü„ÄÇ`;
                    } else {
                        AudioEngine.play('fail');
                        rank.textContent = "F";
                        rank.style.borderColor = "#666";
                        rank.style.color = "#666";
                        title.textContent = "‰øÆÂæ©Â§±Êïó...";
                        desc.innerHTML = `„Éá„Éº„Çø„ÅåÊ∑∑Âú®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ<br>ÊúÄ„ÇÇËøë„ÅÑÂèçÂøú„ÅØ<strong>${bestHero ? bestHero.name : '‰∏çÊòé'}</strong>(${maxMatches}Êûö)„Åß„Åó„Åü„ÄÇ<br>„Ç´„Éº„Éâ„ÅÆÊâÄÂ±û„Çí„Çà„ÅèÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                    }

                    screen.classList.remove('hidden');
                    setTimeout(() => resultBox.classList.add('show'), 100);

                }, 1000); 
            },

            updateControls: function() {
                const swapBtn = document.getElementById('btn-swap');
                const judgeBtn = document.getElementById('btn-judge');
                const status = document.getElementById('turn-status');

                status.textContent = `ÊÆã„ÇäÂÜçÁ∑®ÂõûÊï∞: ${this.turn}`;

                if (this.turn > 0 && !this.isProcessing) {
                    swapBtn.style.display = 'block';
                    swapBtn.disabled = this.selected.size === 0;
                    if (this.selected.size > 0) swapBtn.classList.add('active');
                    else swapBtn.classList.remove('active');
                } else {
                    swapBtn.style.display = 'none';
                }

                if (this.turn === 0 && !this.isProcessing) {
                    status.textContent = "‰øÆÂæ©ÔºàÂà§ÂÆöÔºâ„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
                    judgeBtn.classList.add('active'); 
                    judgeBtn.style.width = "200px";
                } else {
                    judgeBtn.classList.remove('active');
                    judgeBtn.style.width = "140px";
                }
            },

            showEncyclopedia: function() {
                AudioEngine.init();
                const screen = document.getElementById('encyclopedia-screen');
                const grid = document.getElementById('encyclopedia-grid');
                grid.innerHTML = '';
                
                HISTORY_DB.forEach(h => {
                    const div = document.createElement('div');
                    div.style.background = '#222';
                    div.style.padding = '10px';
                    div.style.borderRadius = '8px';
                    div.style.border = '1px solid #444';
                    
                    const unlockedCount = h.cards.filter(c => this.collection[`${h.id}_${c.type}`]).length;
                    const nameColor = unlockedCount >= 3 ? '#eebb44' : '#666';

                    let content = `<div style="color:${nameColor}; font-weight:bold; margin-bottom:5px;">${h.name} <span style="font-size:0.7rem">(${unlockedCount}/5)</span></div>`;
                    h.cards.forEach(c => {
                        const unlocked = this.collection[`${h.id}_${c.type}`];
                        content += `<div style="font-size:0.8rem; color:${unlocked ? '#ddd' : '#444'}; padding:2px 0;">
                            ${unlocked ? c.icon + ' ' + c.text : 'üîí ÔºüÔºüÔºü'}
                        </div>`;
                    });
                    div.innerHTML = content;
                    grid.appendChild(div);
                });
                screen.classList.remove('hidden');
            }
        };
    </script>
</body>
</html>