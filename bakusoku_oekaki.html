<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ†é€Ÿã‚­ãƒ£ãƒ³ãƒã‚¹ - ä¼è¨€ã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@500&display=swap');
        body {
            font-family: 'Kiwi Maru', serif;
            background: #f0f4f8;
            overflow-x: hidden;
        }
        .canvas-container {
            touch-action: none;
            cursor: crosshair;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .timer-bar {
            transition: width 0.1s linear;
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .result-card {
            animation: slideIn 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-indigo-50 min-h-screen flex items-center justify-center p-4">

    <div id="game-container" class="max-w-2xl w-full bg-white rounded-3xl p-6 md:p-8 shadow-2xl">
        <!-- SETUP SCREEN -->
        <div id="setup-screen" class="space-y-6 text-center">
            <h1 class="text-4xl font-bold text-indigo-600 mb-2">ğŸ¨ çˆ†é€Ÿã‚­ãƒ£ãƒ³ãƒã‚¹</h1>
            <p class="text-gray-600">æœ€å¾Œã®äººã¯å›ç­”ã™ã‚‹ã ã‘ï¼çˆ†é€Ÿä¼è¨€ã‚²ãƒ¼ãƒ </p>
            
            <div class="grid grid-cols-2 gap-4 text-left">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°</label>
                    <input type="number" id="player-count" value="3" min="2" max="10" class="w-full border-2 border-indigo-200 rounded-xl px-4 py-2 focus:border-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">åˆ¶é™æ™‚é–“ (ç§’)</label>
                    <input type="number" id="time-limit" value="10" min="5" max="60" class="w-full border-2 border-indigo-200 rounded-xl px-4 py-2 focus:border-indigo-500 outline-none">
                </div>
            </div>

            <button onclick="startGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl transition-all transform hover:scale-105 shadow-lg">
                ã‚²ãƒ¼ãƒ é–‹å§‹ï¼
            </button>
        </div>

        <!-- READY SCREEN -->
        <div id="ready-screen" class="hidden space-y-6 text-center">
            <h2 id="player-turn-label" class="text-3xl font-bold text-indigo-600">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 1 ã®ç•ª</h2>
            <div id="prompt-box" class="bg-indigo-100 p-8 rounded-2xl border-4 border-dashed border-indigo-300">
                <p class="text-sm text-indigo-500 uppercase tracking-widest font-bold">ã‚ãªãŸã¸ã®ãŠé¡Œ</p>
                <p id="current-prompt" class="text-4xl font-black text-indigo-900 mt-2">ãŠé¡Œã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
            <p id="next-instruction" class="text-gray-600 italic">æº–å‚™ãŒã§ããŸã‚‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­</p>
            <button onclick="startAction()" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 rounded-2xl transition-all shadow-lg">
                é€²ã‚€ï¼
            </button>
        </div>

        <!-- DRAWING SCREEN -->
        <div id="drawing-screen" class="hidden space-y-4">
            <div class="flex justify-between items-end">
                <h2 id="drawing-header" class="text-xl font-bold text-gray-700">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 1 ãŒæç”»ä¸­...</h2>
                <div id="timer-text" class="text-2xl font-black text-pink-600">10</div>
            </div>
            <div class="w-full bg-gray-200 h-3 rounded-full overflow-hidden">
                <div id="timer-bar" class="timer-bar h-full bg-pink-500" style="width: 100%"></div>
            </div>
            <div class="canvas-container bg-white border-4 border-indigo-200 rounded-2xl overflow-hidden relative aspect-square">
                <canvas id="main-canvas" class="w-full h-full"></canvas>
            </div>
            <div class="flex gap-2">
                <button onclick="clearCanvas()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded-xl">ã‚„ã‚Šç›´ã—</button>
                <button onclick="finishDrawing()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-xl">æãçµ‚ãˆãŸï¼</button>
            </div>
        </div>

        <!-- GUESS SCREEN -->
        <div id="guess-screen" class="hidden space-y-6 text-center">
            <h2 id="guess-header" class="text-3xl font-bold text-indigo-600">ä½•ã‚’æã„ãŸã¨æ€ã†ï¼Ÿ</h2>
            <div class="border-4 border-indigo-200 rounded-2xl overflow-hidden bg-white aspect-square max-w-sm mx-auto shadow-inner">
                <img id="prev-drawing" class="w-full h-full object-contain" src="" alt="å‰ã®äººã®çµµ">
            </div>
            <div class="space-y-2 text-left">
                <label class="block text-sm font-bold text-gray-700 text-center">ã‚ãªãŸã®äºˆæƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</label>
                <input type="text" id="guess-input" placeholder="ä¾‹ï¼šã‚´ãƒªãƒ©" class="w-full border-2 border-indigo-200 rounded-xl px-4 py-3 focus:border-indigo-500 outline-none text-xl text-center shadow-sm">
            </div>
            <button onclick="submitGuess()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-2xl transition-all shadow-lg">
                æ±ºå®š
            </button>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen" class="hidden space-y-8 overflow-y-auto max-h-[85vh] px-2 pb-8">
            <div class="text-center pt-4">
                <h2 class="text-4xl font-black text-indigo-600">çµæœç™ºè¡¨ï¼</h2>
            </div>
            
            <!-- Comparison Table -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-indigo-100 p-4 rounded-2xl text-center border-2 border-indigo-200">
                    <p class="text-xs font-bold text-indigo-500 uppercase">æœ€åˆã®ãŠé¡Œ</p>
                    <p id="first-prompt-result" class="text-2xl font-black text-indigo-900"></p>
                </div>
                <div id="final-guess-box" class="p-4 rounded-2xl text-center border-2">
                    <p class="text-xs font-bold uppercase opacity-75">æœ€çµ‚å›ç­”</p>
                    <p id="final-guess-result" class="text-2xl font-black"></p>
                </div>
            </div>

            <div id="judgement-text" class="text-center text-3xl font-black italic"></div>

            <div class="border-t-2 border-dashed border-indigo-100 pt-4">
                <p class="text-center text-gray-400 text-sm mb-4">ä¼è¨€ã®ã‚ã‚†ã¿</p>
                <div id="history-container" class="space-y-6">
                    <!-- å±¥æ­´ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                </div>
            </div>

            <button onclick="resetGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg">
                ã‚‚ã†ä¸€åº¦éŠã¶
            </button>
        </div>
    </div>

    <script>
        const prompts = [
            "ãƒ©ã‚¤ã‚ªãƒ³", "ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼", "ã™ã—", "å®‡å®™é£›è¡Œå£«", "ã‚´ãƒªãƒ©", "ãƒ•ãƒ©ãƒ€ãƒ³ã‚¹", "ãƒ‰ãƒ©ãˆã‚‚ã‚“", "ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­", 
            "ãŠåŒ–ã‘å±‹æ•·", "ã‚µãƒƒã‚«ãƒ¼é¸æ‰‹", "ã‚«ãƒã‚­ãƒª", "æ–°å¹¹ç·š", "ã‚¿ãƒ”ã‚ªã‚«", "è‡ªç”±ã®å¥³ç¥", "ã‚­ãƒ£ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼", 
            "å¯Œå£«å±±", "ãƒã‚¤ã‚ªãƒªãƒ‹ã‚¹ãƒˆ", "ãƒšãƒ³ã‚®ãƒ³", "ãƒ©ãƒ¼ãƒ¡ãƒ³", "å®‡å®™äºº", "ã²ã¾ã‚ã‚Š", "æ¶ˆé˜²è»Š", "ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©", 
            "ãŸã“ç„¼ã", "ã‚¸ã‚§ãƒƒãƒˆã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼", "ã‚³ã‚¢ãƒ©", "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼", "ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼", "ã‚¹ãƒ•ã‚£ãƒ³ã‚¯ã‚¹", "äººé­š", 
            "ãƒœã‚¯ã‚·ãƒ³ã‚°", "æµ·è³Š", "ãƒ¡ãƒªãƒ¼ã‚´ãƒ¼ãƒ©ãƒ³ãƒ‰", "ã‹ãæ°·", "ãƒ•ãƒ©ãƒŸãƒ³ã‚´", "å¿è€…", "åŠ›å£«", "ãƒ‰ãƒ¼ãƒŠãƒ„", 
            "ãƒ”ãƒ©ãƒŸãƒƒãƒ‰", "ãƒãƒ¬ãƒªãƒ¼ãƒŠ", "ãƒˆãƒŠã‚«ã‚¤", "ã‚µãƒ³ã‚¿ã‚¯ãƒ­ãƒ¼ã‚¹", "ãƒ›ãƒƒãƒˆãƒ‰ãƒƒã‚°", "ã‚µãƒœãƒ†ãƒ³", "æç«œ", 
            "ã‚µãƒ¼ãƒ•ã‚£ãƒ³", "ã‚«ã‚¦ãƒœãƒ¼ã‚¤", "é‡‘é­šã™ãã„", "æ°—çƒ", "æ½œæ°´è‰¦", "ç›®ç‰ç„¼ã", "ã‚¯ãƒªã‚ªãƒ", "ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³", 
            "ã‚­ãƒªãƒ³", "ã‚·ãƒ£ãƒ³ãƒ‡ãƒªã‚¢", "ãƒãƒ³ãƒ‘ãƒ³ã‚¸ãƒ¼", "ãƒãƒˆãƒªãƒ§ãƒ¼ã‚·ã‚«", "ãƒ¢ã‚¢ã‚¤åƒ", "ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³", "ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼",
            "ãŠã«ãã‚Š", "ã‚ªãƒ ãƒ©ã‚¤ã‚¹", "ãƒ¡ãƒ­ãƒ³ãƒ‘ãƒ³", "ãŸã¬ã", "ãƒãƒå…¬", "ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”", "ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼", 
            "ãƒ‘ãƒ©ã‚·ãƒ¥ãƒ¼ãƒˆ", "ãŠè¾å„€", "æ­¯ç£¨ã", "ã‚¹ã‚­ãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—", "ç¶±å¼•ã", "ç¦ç¬‘ã„", "ç·šé¦™èŠ±ç«"
        ];
        
        let playerCount = 3;
        let timeLimit = 10;
        let currentPlayer = 1;
        let history = []; 
        let firstPrompt = "";
        let currentDrawing = "";
        
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let timerInterval;
        let timeLeft;

        function resizeCanvas() {
            const rect = canvas.parentNode.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#4338ca';
        }

        window.addEventListener('resize', resizeCanvas);

        canvas.addEventListener('mousedown', startPos);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endPos);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startPos(e.touches[0]); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });
        canvas.addEventListener('touchend', (e) => { e.preventDefault(); endPos(); });

        function startPos(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            [lastX, lastY] = [x, y];
        }

        function endPos() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function startGame() {
            playerCount = parseInt(document.getElementById('player-count').value);
            timeLimit = parseInt(document.getElementById('time-limit').value);
            currentPlayer = 1;
            history = [];
            firstPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            currentDrawing = "";
            
            showScreen('ready-screen');
            updateReadyScreen();
        }

        function updateReadyScreen() {
            document.getElementById('player-turn-label').innerText = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${currentPlayer} ã®ç•ª`;
            const promptBox = document.getElementById('prompt-box');
            const currentPromptEl = document.getElementById('current-prompt');
            const instruction = document.getElementById('next-instruction');

            if (currentPlayer === 1) {
                promptBox.classList.remove('hidden');
                currentPromptEl.innerText = firstPrompt;
                instruction.innerText = "ãŠé¡Œã‚’è¦šãˆãŸã‚‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­";
            } else if (currentPlayer === playerCount) {
                promptBox.classList.add('hidden');
                instruction.innerText = "æœ€å¾Œã®äººï¼å‰ã®äººã®çµµã‚’å½“ã¦ã¦çµ‚äº†ã ã‚ˆ";
            } else {
                promptBox.classList.add('hidden');
                instruction.innerText = "å‰ã®äººã®çµµã‚’å½“ã¦ã‚‹æº–å‚™ã¯ã„ã„ï¼Ÿ";
            }
        }

        function startAction() {
            if (currentPlayer === 1) {
                startDrawing();
            } else {
                showGuessScreen();
            }
        }

        function startDrawing() {
            showScreen('drawing-screen');
            resizeCanvas();
            clearCanvas();
            document.getElementById('drawing-header').innerText = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${currentPlayer} æç”»ä¸­...`;
            
            timeLeft = timeLimit;
            updateTimerUI();
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishDrawing();
                }
                updateTimerUI();
            }, 100);
        }

        function updateTimerUI() {
            const percentage = Math.max(0, (timeLeft / timeLimit) * 100);
            document.getElementById('timer-bar').style.width = `${percentage}%`;
            document.getElementById('timer-text').innerText = Math.ceil(Math.max(0, timeLeft));
            
            const timerBar = document.getElementById('timer-bar');
            if (timeLeft < 3) {
                document.getElementById('timer-text').classList.add('shake');
                timerBar.classList.remove('bg-pink-500');
                timerBar.classList.add('bg-red-500');
            } else {
                document.getElementById('timer-text').classList.remove('shake');
                timerBar.classList.remove('bg-red-500');
                timerBar.classList.add('bg-pink-500');
            }
        }

        function finishDrawing() {
            clearInterval(timerInterval);
            currentDrawing = canvas.toDataURL();
            history.push({ type: 'draw', content: currentDrawing, player: currentPlayer });

            currentPlayer++;
            showScreen('ready-screen');
            updateReadyScreen();
        }

        function showGuessScreen() {
            showScreen('guess-screen');
            document.getElementById('guess-header').innerText = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${currentPlayer} ã•ã‚“`;
            document.getElementById('prev-drawing').src = currentDrawing;
            document.getElementById('guess-input').value = "";
            setTimeout(() => document.getElementById('guess-input').focus(), 100);
        }

        function submitGuess() {
            const guess = document.getElementById('guess-input').value.trim() || "ï¼ˆç„¡å›ç­”ï¼‰";
            history.push({ type: 'guess', content: guess, player: currentPlayer });

            if (currentPlayer === playerCount) {
                showResults();
            } else {
                startDrawing();
            }
        }

        function showResults() {
            showScreen('result-screen');
            
            const firstPromptEl = document.getElementById('first-prompt-result');
            const finalGuessEl = document.getElementById('final-guess-result');
            const finalGuessBox = document.getElementById('final-guess-box');
            const judgementText = document.getElementById('judgement-text');
            const container = document.getElementById('history-container');
            
            container.innerHTML = "";
            firstPromptEl.innerText = firstPrompt;

            const lastGuessObj = history[history.length - 1];
            const finalGuessValue = lastGuessObj ? lastGuessObj.content : "ï¼ˆãªã—ï¼‰";
            finalGuessEl.innerText = finalGuessValue;

            if (finalGuessValue === firstPrompt) {
                judgementText.innerText = "SUCCESS! ğŸ‰";
                judgementText.className = "text-center text-4xl font-black italic text-green-500";
                finalGuessBox.className = "p-4 rounded-2xl text-center border-2 border-green-500 bg-green-50 text-green-700";
            } else {
                judgementText.innerText = "FAILED... ğŸ˜±";
                judgementText.className = "text-center text-4xl font-black italic text-red-500";
                finalGuessBox.className = "p-4 rounded-2xl text-center border-2 border-red-500 bg-red-50 text-red-700";
            }
            
            history.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = "result-card bg-white border-2 border-gray-100 rounded-3xl p-4 shadow-sm flex flex-col items-center gap-3";
                card.style.animationDelay = `${index * 0.1}s`;
                
                if (item.type === 'draw') {
                    card.innerHTML = `
                        <div class="w-full flex justify-between items-center text-gray-400 text-xs px-2 font-bold">
                            <span>PLAYER ${item.player}</span>
                            <span class="bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full">çµµã‚’ã‹ã„ãŸ</span>
                        </div>
                        <img src="${item.content}" class="w-full max-w-sm border-2 border-indigo-50 rounded-xl bg-indigo-50/30">
                    `;
                } else {
                    card.innerHTML = `
                        <div class="w-full flex justify-between items-center text-gray-400 text-xs px-2 font-bold">
                            <span>PLAYER ${item.player}</span>
                            <span class="bg-pink-100 text-pink-600 px-2 py-0.5 rounded-full">${item.player === playerCount ? 'æœ€çµ‚å›ç­”' : 'äºˆæƒ³ã—ãŸ'}</span>
                        </div>
                        <p class="text-2xl font-black text-indigo-900 mt-1">ã€Œ${item.content}ã€</p>
                    `;
                }
                container.appendChild(card);
            });
        }

        function showScreen(screenId) {
            ['setup-screen', 'ready-screen', 'drawing-screen', 'guess-screen', 'result-screen'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function resetGame() {
            showScreen('setup-screen');
        }
    </script>
</body>
</html>